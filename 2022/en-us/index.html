<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.16">
<meta name="author" content="Jim Fang, Jing Xiao, Mercy Ma, Xiaolong Zuo, Bingting Peng, Yuxin Wang, Steve Rao">
<title>Spring Cloud Alibaba Reference Documentation</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;-webkit-tap-highlight-color:transparent}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.css">
</head>
<body id="spring-cloud-alibaba-reference" class="book">
<div id="header">
<h1>Spring Cloud Alibaba Reference Documentation</h1>
<div class="details">
<span id="author" class="author">Jim Fang, Jing Xiao, Mercy Ma, Xiaolong Zuo, Bingting Peng, Yuxin Wang, Steve Rao</span><br>
</div>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_introduction">1. Introduction</a></li>
<li><a href="#_dependency_management">2. Dependency Management</a></li>
<li><a href="#_spring_cloud_alibaba_nacos_discovery">3. Spring Cloud Alibaba Nacos Discovery</a>
<ul class="sectlevel2">
<li><a href="#_service_registrationdiscovery_nacos_discovery">3.1. Service Registration/Discovery: Nacos Discovery</a></li>
<li><a href="#_how_to_introduce_nacos_discovery_for_service_registrationdiscovery">3.2. How to Introduce Nacos Discovery for service registration/discovery</a></li>
<li><a href="#_an_example_of_using_nacos_discovery_for_service_registrationdiscovery_and_call">3.3. An example of using Nacos Discovery for service registration/discovery and call</a>
<ul class="sectlevel3">
<li><a href="#_nacos_server_startup">3.3.1. Nacos Server Startup</a></li>
<li><a href="#_start_a_provider_application">3.3.2. Start a Provider Application</a></li>
<li><a href="#_start_a_consumer_application">3.3.3. Start a Consumer Application</a></li>
</ul>
</li>
<li><a href="#_nacos_discovery_endpoint">3.4. Nacos Discovery Endpoint</a></li>
<li><a href="#_weight_route">3.5. Weight Route</a>
<ul class="sectlevel3">
<li><a href="#_spring_cloud_loadbalancer">3.5.1. Spring Cloud Loadbalancer</a></li>
</ul>
</li>
<li><a href="#_more_information_about_nacos_discovery_starter_configurations">3.6. More Information about Nacos Discovery Starter Configurations</a></li>
</ul>
</li>
<li><a href="#_spring_cloud_alibaba_nacos_config">4. Spring Cloud Alibaba Nacos Config</a>
<ul class="sectlevel2">
<li><a href="#_how_to_introduce_nacos_config_for_configuration">4.1. How to Introduce Nacos Config for configuration</a></li>
<li><a href="#_quickstart">4.2. Quickstart</a>
<ul class="sectlevel3">
<li><a href="#_initialize_nacos_server">4.2.1. Initialize Nacos Server</a>
<ul class="sectlevel4">
<li><a href="#_usage_on_the_client">Usage on the Client</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_add_configurations_with_dataid_in_yaml_format">4.3. Add Configurations with DataId in YAML Format</a></li>
<li><a href="#_support_dynamic_configuration_udpates">4.4. Support Dynamic Configuration Udpates</a></li>
<li><a href="#_support_configurations_at_the_profile_level">4.5. Support configurations at the profile level</a></li>
<li><a href="#_support_custom_namespaces">4.6. Support Custom Namespaces</a></li>
<li><a href="#_support_custom_groups">4.7. Support Custom Groups</a></li>
<li><a href="#_support_custom_data_id">4.8. Support Custom Data Id</a></li>
<li><a href="#_nacos_config_endpoint">4.9. Nacos Config Endpoint</a></li>
<li><a href="#_disable_nacos_config_autoconfiguration">4.10. Disable Nacos Config AutoConfiguration</a></li>
<li><a href="#_more_information_about_nacos_config_starter_configurations">4.11. More Information about Nacos Config Starter Configurations</a></li>
</ul>
</li>
<li><a href="#_spring_cloud_alibaba_sentinel">5. Spring Cloud Alibaba Sentinel</a>
<ul class="sectlevel2">
<li><a href="#_introduction_of_sentinel">5.1. Introduction of Sentinel</a></li>
<li><a href="#_how_to_use_sentinel">5.2. How to Use Sentinel</a>
<ul class="sectlevel4">
<li><a href="#_sentinel_dashboard">Sentinel Dashboard</a></li>
<li><a href="#_configure_the_dashboard">5.2.2. Configure the Dashboard</a></li>
</ul>
</li>
<li><a href="#_openfeign_support">5.3. OpenFeign Support</a></li>
<li><a href="#_resttemplate_support">5.4. RestTemplate Support</a></li>
<li><a href="#_dynamic_data_source_support">5.5. Dynamic Data Source Support</a></li>
<li><a href="#_support_spring_cloud_gateway">5.6. Support Spring Cloud Gateway</a></li>
<li><a href="#_circuit_breaker_spring_cloud_circuit_breaker_with_sentinel_configuring_sentinel_circuit_breakers">5.7. Circuit Breaker: Spring Cloud Circuit Breaker With Sentinel &amp; Configuring Sentinel Circuit Breakers</a>
<ul class="sectlevel3">
<li><a href="#_default_configuration">5.7.1. Default Configuration</a>
<ul class="sectlevel4">
<li><a href="#_reactive_example">Reactive Example</a></li>
</ul>
</li>
<li><a href="#_specific_circuit_breaker_configuration">5.7.2. Specific Circuit Breaker Configuration</a>
<ul class="sectlevel4">
<li><a href="#_reactive_example_2">Reactive Example</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_sentinel_endpoint">5.8. Sentinel Endpoint</a></li>
<li><a href="#_configuration">5.9. Configuration</a></li>
</ul>
</li>
<li><a href="#_spring_cloud_alibaba_rocketmq_binder">6. Spring Cloud Alibaba RocketMQ Binder</a>
<ul class="sectlevel2">
<li><a href="#_introduction_of_rocketmq">6.1. Introduction of RocketMQ</a></li>
<li><a href="#_rocketmq_usages">6.2. RocketMQ Usages</a></li>
<li><a href="#_introduction_of_spring_cloud_stream">6.3. Introduction of Spring Cloud Stream</a></li>
<li><a href="#_how_to_use_spring_cloud_alibaba_rocketmq_binder">6.4. How to use Spring Cloud Alibaba RocketMQ Binder</a></li>
<li><a href="#_how_spring_cloud_alibaba_rocketmq_binder_works">6.5. How Spring Cloud Alibaba RocketMQ Binder Works</a></li>
<li><a href="#_configuration_options">6.6. Configuration Options</a>
<ul class="sectlevel3">
<li><a href="#_rocketmq_binder_properties">6.6.1. RocketMQ Binder Properties</a></li>
<li><a href="#_rocketmq_consumer_properties">6.6.2. RocketMQ Consumer Properties</a></li>
<li><a href="#_rocketmq_provider_properties">6.6.3. RocketMQ Provider Properties</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_spring_cloud_alibaba_cloud_ans">7. Spring Cloud Alibaba Cloud ANS</a>
<ul class="sectlevel2">
<li><a href="#_how_to_introduce_spring_cloud_alibaba_cloud_ans">7.1. How to Introduce Spring Cloud Alibaba Cloud ANS</a></li>
<li><a href="#_use_ans_to_register_service">7.2. Use ANS to Register Service</a></li>
<li><a href="#_start_registration_center">7.3. Start Registration Center</a>
<ul class="sectlevel3">
<li><a href="#_start_lightweight_configuration_center">7.3.1. Start Lightweight Configuration Center</a></li>
<li><a href="#_user_registration_center_on_the_cloud">7.3.2. User Registration Center on the Cloud</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_spring_cloud_alibaba_cloud_acm">8. Spring Cloud Alibaba Cloud ACM</a>
<ul class="sectlevel2">
<li><a href="#_how_to_introduce_spring_cloud_alibaba_cloud_acm">8.1. How to Introduce Spring Cloud Alibaba Cloud ACM</a></li>
<li><a href="#_use_acm_to_manage_configurations">8.2. Use ACM to Manage Configurations</a>
<ul class="sectlevel3">
<li><a href="#_start_configuration_center">8.2.1. Start Configuration Center</a>
<ul class="sectlevel4">
<li><a href="#_use_lightweight_configuration_center">Use Lightweight Configuration Center</a></li>
<li><a href="#_use_acm_on_the_alibaba_cloud">Use ACM on the Alibaba Cloud</a></li>
</ul>
</li>
<li><a href="#_add_configuration_in_the_configuration_center">8.2.2. Add Configuration in the Configuration Center</a></li>
<li><a href="#_start_application_verification">8.2.3. Start Application Verification</a></li>
</ul>
</li>
<li><a href="#_modify_configuration_file_extension">8.3. Modify Configuration File Extension</a></li>
<li><a href="#_dynamic_configuration_refresh">8.4. Dynamic Configuration Refresh</a></li>
<li><a href="#_configure_profile_granularity">8.5. Configure Profile Granularity</a></li>
<li><a href="#_support_custom_acm_timeout">8.6. Support Custom ACM Timeout</a></li>
<li><a href="#_support_custom_group_configurations">8.7. Support Custom Group Configurations</a>
<ul class="sectlevel3">
<li><a href="#_support_shared_configurations">8.7.1. Support Shared Configurations</a></li>
</ul>
</li>
<li><a href="#_actuator_endpoint">8.8. Actuator Endpoint</a></li>
</ul>
</li>
<li><a href="#_spring_cloud_alibaba_cloud_oss">9. Spring Cloud Alibaba Cloud OSS</a>
<ul class="sectlevel2">
<li><a href="#_how_to_introduce_spring_cloud_alibaba_cloud_oss">9.1. How to Introduce Spring Cloud Alibaba Cloud OSS</a></li>
<li><a href="#_how_to_use_oss_api">9.2. How to Use OSS API</a>
<ul class="sectlevel3">
<li><a href="#_configure_oss">9.2.1. Configure OSS</a></li>
<li><a href="#_introduce_oss_api">9.2.2. Introduce OSS API</a></li>
</ul>
</li>
<li><a href="#_integrate_with_the_resource_specifications_of_spring">9.3. Integrate with the Resource Specifications of Spring</a></li>
<li><a href="#_use_sts_authentication">9.4. Use STS Authentication</a></li>
<li><a href="#_more_configurations_for_the_client">9.5. More Configurations for the Client</a></li>
</ul>
</li>
<li><a href="#_spring_cloud_alibaba_cloud_schedulerx">10. Spring Cloud Alibaba Cloud SchedulerX</a>
<ul class="sectlevel2">
<li><a href="#_how_to_introduce_spring_cloud_alibaba_cloud_schedulerx">10.1. How to Introduce Spring Cloud Alibaba Cloud SchedulerX</a></li>
<li><a href="#_start_schedulerx">10.2. Start SchedulerX</a></li>
<li><a href="#_compile_a_simple_job">10.3. Compile a simple job</a></li>
<li><a href="#_job_scheduling">10.4. Job Scheduling</a></li>
<li><a href="#_usage_in_production_environment">10.5. Usage in Production Environment</a></li>
</ul>
</li>
<li><a href="#_spring_cloud_alibaba_cloud_sms">11. Spring Cloud Alibaba Cloud SMS</a>
<ul class="sectlevel2">
<li><a href="#_how_to_introduce_spring_cloud_alibaba_cloud_sms">11.1. How to Introduce Spring Cloud Alibaba Cloud SMS</a></li>
<li><a href="#_how_to_use_sms_api">11.2. How to use SMS API</a>
<ul class="sectlevel3">
<li><a href="#_configure_sms">11.2.1. Configure SMS</a></li>
<li><a href="#_introduce_sms_api">11.2.2. Introduce SMS API</a></li>
</ul>
</li>
<li><a href="#_the_advanced_features_of_sms_api">11.3. The Advanced Features of SMS Api</a></li>
</ul>
</li>
<li><a href="#_aot_and_native_image_support">12. AOT and Native Image Support</a>
<ul class="sectlevel2">
<li><a href="#_introduction_to_graalvm">12.1. Introduction to GraalVM</a></li>
<li><a href="#_build_application_by_graalvm">12.2. Build Application by GraalVM</a>
<ul class="sectlevel3">
<li><a href="#_build_the_project">12.2.1. Build the project</a></li>
<li><a href="#_preparation">12.2.2. Preparation</a></li>
<li><a href="#_generate_hint_file">12.2.3. Generate hint file</a></li>
<li><a href="#_build_native_image">12.2.4. Build native image</a></li>
<li><a href="#_run_native_image">12.2.5. Run native image</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_introduction">1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Cloud Alibaba aims to provide a one-stop solution for microservices development. This project includes the required components for developing distributed applications and services, so that developers can develop distributed applications easily with the Spring Cloud programming models.</p>
</div>
<div class="paragraph">
<p>With Spring Cloud Alibaba, you only need to add a few annotations and configurations, and you will be able to use the distributed solutions of Alibaba for your applications, and build a distributed system of your own with Alibaba middleware.</p>
</div>
<div class="paragraph">
<p>The features of Spring Cloud Alibaba:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Flow control and service degradation</strong>：support WebServlet, WebFlux, OpenFeign, RestTemplate, Dubbo access to the function of limiting and degrading flow. It can modify the rules of limiting and degrading flow in real time through the console at run time, and it also supports the monitoring of limiting and degrading Metrics.</p>
</li>
<li>
<p><strong>Service registration and discovery</strong>：Service can be registered and clients can discover the instances using Spring-managed beans, auto integration Ribbon.</p>
</li>
<li>
<p><strong>Distributed configuration</strong>：support for externalized configuration in a distributed system, auto refresh when configuration changes.</p>
</li>
<li>
<p><strong>Rpc Service</strong>：extend Spring Cloud client RestTemplate and OpenFeign to support calling Dubbo RPC services.</p>
</li>
<li>
<p><strong>Event-driven</strong>：support for building highly scalable event-driven microservices connected with shared messaging systems.</p>
</li>
<li>
<p><strong>Distributed Transaction</strong>：support for distributed transaction solution with high performance and ease of use.</p>
</li>
<li>
<p><strong>Alibaba Cloud Object Storage</strong>：massive, secure, low-cost, and highly reliable cloud storage services. Support for storing and accessing any type of data in any application, anytime, anywhere.</p>
</li>
<li>
<p><strong>Alibaba Cloud SchedulerX</strong>：accurate, highly reliable, and highly available scheduled job scheduling services with response time within seconds.</p>
</li>
<li>
<p><strong>Alibaba Cloud SMS</strong>： A messaging service that covers the globe, Alibaba SMS provides convenient, efficient, and intelligent communication capabilities that help businesses quickly contact their customers.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Spring Cloud Alibaba also provide rich <a href="https://github.com/alibaba/spring-cloud-alibaba/tree/master/spring-cloud-alibaba-examples">examples</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dependency_management">2. Dependency Management</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you’re a Maven Central user, add our BOM to your pom.xml &lt;dependencyManagement&gt; section. This will allow you to omit versions for any of the Maven dependencies and instead delegate versioning to the BOM.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;dependencyManagement&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-alibaba-dependencies&lt;/artifactId&gt;
            &lt;version&gt;2022.0.0.0-RC1&lt;/version&gt;
            &lt;type&gt;pom&lt;/type&gt;
            &lt;scope&gt;import&lt;/scope&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
&lt;/dependencyManagement&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the following sections, it will be assumed you are using the Spring Cloud Alibaba BOM and the dependency snippets will not contain versions.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_spring_cloud_alibaba_nacos_discovery">3. Spring Cloud Alibaba Nacos Discovery</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Nacos is an easy-to-use dynamic service discovery, configuration and service management platform for building cloud native applications.</p>
</div>
<div class="paragraph">
<p>With Spring Cloud Alibaba Nacos Discovery, you can quickly access the Nacos service registration feature based on Spring Cloud&#8217;s programming model.</p>
</div>
<div class="sect2">
<h3 id="_service_registrationdiscovery_nacos_discovery">3.1. Service Registration/Discovery: Nacos Discovery</h3>
<div class="paragraph">
<p>Service discovery is one of the key components in the microservices architecture. In such a architecture, configuring a service list for every client manually could be a daunting task, and makes dynamic scaling extremely difficult.
 Nacos Discovery helps you to register your service to the Nacos server automatically, and the Nacos server keeps track of the services and refreshes the service list dynamically. In addition, Nacos
Discovery registers some of the metadata of the service instance, such as host, port, health check URL, homepage to Nacos. For details about how to download and start Nacos, refer to the <a href="https://nacos.io/zh-cn/docs/quick-start.html">Nacos Website</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_how_to_introduce_nacos_discovery_for_service_registrationdiscovery">3.2. How to Introduce Nacos Discovery for service registration/discovery</h3>
<div class="paragraph">
<p>please use the starter with the group ID as <code>com.alibaba.cloud</code> and the artifact ID as <code>spring-cloud-starter-alibaba-nacos-discovery</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_an_example_of_using_nacos_discovery_for_service_registrationdiscovery_and_call">3.3. An example of using Nacos Discovery for service registration/discovery and call</h3>
<div class="paragraph">
<p>Nacos Discovery integrate with the Netflix Ribbon, RestTemplate or OpenFeign can be used for service-to-service calls.</p>
</div>
<div class="sect3">
<h4 id="_nacos_server_startup">3.3.1. Nacos Server Startup</h4>
<div class="paragraph">
<p>For details about how to download and start Nacos, refer to the <a href="https://nacos.io/zh-cn/docs/quick-start.html">Nacos Website</a>.</p>
</div>
<div class="paragraph">
<p>After Nacos Server starts, go to <a href="http://ip:8848" class="bare">http://ip:8848</a> to view the console (default account name/password is nacos/nacos):</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://img.alicdn.com/tfs/TB1XEfwbQH0gK0jSZPiXXavapXa-2790-1060.png" alt="TB1XEfwbQH0gK0jSZPiXXavapXa 2790 1060">
</div>
<div class="title">Figure 1. Nacos Dashboard</div>
</div>
<div class="paragraph">
<p>For more Nacos Server versions, you can download the latest version from <a href="https://github.com/alibaba/nacos/releases">release page</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_start_a_provider_application">3.3.2. Start a Provider Application</h4>
<div class="paragraph">
<p>The following sample illustrates how to register a service to Nacos.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Configuration of pom.xml The following is a complete example of pom.xml：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">pom.xml</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

    &lt;groupId&gt;open.source.test&lt;/groupId&gt;
    &lt;artifactId&gt;nacos-discovery-test&lt;/artifactId&gt;
    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
    &lt;name&gt;nacos-discovery-test&lt;/name&gt;

    &lt;parent&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
        &lt;version&gt;${spring.boot.version}&lt;/version&gt;
        &lt;relativePath/&gt;
    &lt;/parent&gt;

    &lt;properties&gt;
        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;
        &lt;project.reporting.outputEncoding&gt;UTF-8&lt;/project.reporting.outputEncoding&gt;
        &lt;java.version&gt;1.8&lt;/java.version&gt;
    &lt;/properties&gt;

    &lt;dependencyManagement&gt;
        &lt;dependencies&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
                &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt;
                &lt;version&gt;${spring.cloud.version}&lt;/version&gt;
                &lt;type&gt;pom&lt;/type&gt;
                &lt;scope&gt;import&lt;/scope&gt;
            &lt;/dependency&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;
                &lt;artifactId&gt;spring-cloud-alibaba-dependencies&lt;/artifactId&gt;
                &lt;version&gt;${spring.cloud.alibaba.version}&lt;/version&gt;
                &lt;type&gt;pom&lt;/type&gt;
                &lt;scope&gt;import&lt;/scope&gt;
            &lt;/dependency&gt;
        &lt;/dependencies&gt;
    &lt;/dependencyManagement&gt;

    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;

    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;
&lt;/project&gt;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Configuration of application.properties Some of the basic configurations of Nacos must be included in application.properties(or application.yaml), as shown below：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">application.properties</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="properties">server.port=8081
spring.application.name=nacos-provider
spring.cloud.nacos.discovery.server-addr=127.0.0.1:8848
management.endpoints.web.exposure.include=*</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If you do not want to use Nacos for service registration and discovery, you can set <code>spring.cloud.nacos.discovery</code> to <code>false</code>.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>The following is a sample for starting Provider:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@SpringBootApplication
@EnableDiscoveryClient
public class NacosProviderDemoApplication {

    public static void main(String[] args) {
        SpringApplication.run(NacosProviderDemoApplication.class, args);
    }

    @RestController
    public class EchoController {
        @GetMapping(value = "/echo/{string}")
        public String echo(@PathVariable String string) {
            return "Hello Nacos Discovery " + string;
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now you can see the registered services on the Nacos console.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Before you start the provider application, please start Nacos first. Refer to <a href="https://nacos.io/zh-cn/docs/quick-start.html">Naco Website</a> for more details.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_start_a_consumer_application">3.3.3. Start a Consumer Application</h4>
<div class="paragraph">
<p>It might not be as easy as starting a provider application, because the consumer needs to call the RESTful service of the provider. In this example, we will use the most primitive way, that is,
combining the LoadBalanceClient and RestTemplate explicitly to access the RESTful service.
You can refer to section 1.2 for pom.xml and application.properties configurations. The following is the sample code for starting a consumer application.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You can also access the service by using RestTemplate and FeignClient with load balancing.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@SpringBootApplication
@EnableDiscoveryClient
public class NacosConsumerApp {

    @RestController
    public class NacosController{

        @Autowired
        private LoadBalancerClient loadBalancerClient;
        @Autowired
        private RestTemplate restTemplate;

        @Value("${spring.application.name}")
        private String appName;

        @GetMapping("/echo/app-name")
        public String echoAppName(){
            //Access through the combination of LoadBalanceClient and RestTemplate
            ServiceInstance serviceInstance = loadBalancerClient.choose("nacos-provider");
            String path = String.format("http://%s:%s/echo/%s",serviceInstance.getHost(),serviceInstance.getPort(),appName);
            System.out.println("request path:" +path);
            return restTemplate.getForObject(path,String.class);
        }

    }

    //Instantiate RestTemplate Instance
    @Bean
    public RestTemplate restTemplate(){

        return new RestTemplate();
    }

    public static void main(String[] args) {

        SpringApplication.run(NacosConsumerApp.class,args);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, we injected a LoadBalancerClient instance, and instantiated a RestTemplate manually. At the same time, we injected the configuration value of <code>spring.application.name</code> into the application,
so that the current application name can be displayed when calling the service of the provider.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Please start Nacos before you start the consumer application. For details, please refer to <a href="https://nacos.io/zh-cn/docs/quick-start.html">Nacos Website</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Next, access the <code><a href="http://ip:port/echo/app-name" class="bare">http://ip:port/echo/app-name</a></code> interface provided by the consumer. Here we started the port of 8082. The access result is shown below：</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Address：http://127.0.0.1:8082/echo/app-name
Access result： Hello Nacos Discovery nacos-consumer</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_nacos_discovery_endpoint">3.4. Nacos Discovery Endpoint</h3>
<div class="paragraph">
<p>Nacos Discovery provides an Endpoint internally with a corresponding endpoint id of <code>nacosdiscovery</code>.</p>
</div>
<div class="paragraph">
<p>Endpoint exposed json contains two properties:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>subscribe: Shows the current service subscribers</p>
</li>
<li>
<p>NacosDiscoveryProperties: Shows the current basic Nacos configurations of the current service</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The followings shows how a service instance accesses the Endpoint:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="json">{
  "subscribe": [
    {
      "jsonFromServer": "",
      "name": "nacos-provider",
      "clusters": "",
      "cacheMillis": 10000,
      "hosts": [
        {
          "instanceId": "30.5.124.156#8081#DEFAULT#nacos-provider",
          "ip": "30.5.124.156",
          "port": 8081,
          "weight": 1.0,
          "healthy": true,
          "enabled": true,
          "cluster": {
            "serviceName": null,
            "name": null,
            "healthChecker": {
              "type": "TCP"
            },
            "defaultPort": 80,
            "defaultCheckPort": 80,
            "useIPPort4Check": true,
            "metadata": {

            }
          },
          "service": null,
          "metadata": {

          }
        }
      ],
      "lastRefTime": 1541755293119,
      "checksum": "e5a699c9201f5328241c178e804657e11541755293119",
      "allIPs": false,
      "key": "nacos-provider",
      "valid": true
    }
  ],
  "NacosDiscoveryProperties": {
    "serverAddr": "127.0.0.1:8848",
    "endpoint": "",
    "namespace": "",
    "logName": "",
    "service": "nacos-provider",
    "weight": 1.0,
    "clusterName": "DEFAULT",
    "metadata": {

    },
    "registerEnabled": true,
    "ip": "30.5.124.201",
    "networkInterface": "",
    "port": 8082,
    "secure": false,
    "accessKey": "",
    "secretKey": ""
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_weight_route">3.5. Weight Route</h3>
<div class="sect3">
<h4 id="_spring_cloud_loadbalancer">3.5.1. Spring Cloud Loadbalancer</h4>
<div class="listingblock">
<div class="title">pom.xml</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
        &lt;artifactId&gt;spring-cloud-loadbalancer&lt;/artifactId&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">application.properties</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="properties">spring.cloud.loadbalancer.ribbon.enabled=false
spring.cloud.loadbalancer.nacos.enabled=true</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_more_information_about_nacos_discovery_starter_configurations">3.6. More Information about Nacos Discovery Starter Configurations</h3>
<div class="paragraph">
<p>The following shows the other configurations of the starter of Nacos Discovery:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default Value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Server address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.nacos.discovery.server-addr</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IP and port of the Nacos Server listener</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.nacos.discovery.service</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${spring.application.name}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name the current service</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Weight</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.nacos.discovery.weight</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Value range: 1 to 100. The bigger the value, the greater the weight</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Network card name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.nacos.discovery.network-interface</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the IP address is not specified, the registered IP address is the IP address of the network card. If this is not specified either, the IP address of the first network card will be used by default.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Registered IP address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.nacos.discovery.ip</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Highest priority</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Registered IP address Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.nacos.discovery.ip-type</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IPv4</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IPv4 and IPv6 can be configured, If there are multiple IP addresses of the same type of network card, and you want to specify a specific network segment address, you can use <code>spring.cloud.inetutils.preferred-networks</code> to configure the filter address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Registered port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.nacos.discovery.port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Will be detected automatically by default. Do not need to be configured.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Namespace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.nacos.discovery.namespace</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A typical scenario is to isolate the service registration for different environment, such as resource (configurations, services etc.) isolation between testing and production environment</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AccessKey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.nacos.discovery.access-key</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alibaba Cloud account accesskey</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SecretKey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.nacos.discovery.secret-key</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alibaba Cloud account secretkey</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Metadata</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.nacos.discovery.metadata</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">You can define some of the metadata for your services in the Map format</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log file name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.nacos.discovery.log-name</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cluster Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.nacos.discovery.cluster-name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DEFAULT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cluster name of Nacos</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Endpoint</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.nacos.discovery.endpoint</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The domain name of a certain service in a specific region. You can retrieve the server address dynamically with this domain name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integrate LoadBalancer or not</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.loadbalancer.nacos.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable Nacos Watch</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.nacos.discovery.watch.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set to true to enable watch</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_spring_cloud_alibaba_nacos_config">4. Spring Cloud Alibaba Nacos Config</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Nacos is an easy-to-use dynamic service discovery, configuration and service management platform for building cloud native applications.</p>
</div>
<div class="paragraph">
<p>Use Spring Cloud Alibaba Nacos Config to quickly access Nacos configuration management capabilities based on Spring Cloud&#8217;s programming model.</p>
</div>
<div class="sect2">
<h3 id="_how_to_introduce_nacos_config_for_configuration">4.1. How to Introduce Nacos Config for configuration</h3>
<div class="paragraph">
<p>please use the starter with the group ID as <code>com.alibaba.cloud</code> and the artifact ID as <code>spring-cloud-starter-alibaba-nacos-config</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-config&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_quickstart">4.2. Quickstart</h3>
<div class="paragraph">
<p>Nacos Config uses DataId and GROUP to determine a configuration.</p>
</div>
<div class="paragraph">
<p>The following figure shows that the DataId uses <code>myDataid</code>, GROUP uses <code>DEFAULT_GROUP</code>, and configures a configuration item of the format Properties:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://img.alicdn.com/tfs/TB1N2nxbRr0gK0jSZFnXXbRRXXa-2448-1194.png" alt="TB1N2nxbRr0gK0jSZFnXXbRRXXa 2448 1194">
</div>
<div class="title">Figure 2. Nacos Config Item</div>
</div>
<div class="sect3">
<h4 id="_initialize_nacos_server">4.2.1. Initialize Nacos Server</h4>
<div class="paragraph">
<p>For specific startup methods, refer to the "Nacos Server Startup" section of the Spring Cloud Alibaba Nacos Discovery section.</p>
</div>
<div class="paragraph">
<p>After the Nacos Server is started, add how to configure it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>Data ID:    nacos-config.properties

Group  :    DEFAULT_GROUP

Configuration format:    Properties

Configuration content:   user.name=nacos-config-properties
            user.age=90</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The default file extension of DataId is properties.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_usage_on_the_client">Usage on the Client</h5>
<div class="paragraph">
<p>If you want to use Nacos to manage externalized configurations for your applications, please use the starter with the group ID as <code>com.alibaba.cloud</code> and the artifact ID as <code>spring-cloud-starter-alibaba-nacos-config</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-config&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we can create a standard Spring Boot application.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@SpringBootApplication
public class NacosConfigApplication {

    public static void main(String[] args) {
        ConfigurableApplicationContext applicationContext = SpringApplication.run(NacosConfigApplication.class, args);
        String userName = applicationContext.getEnvironment().getProperty("user.name");
        String userAge = applicationContext.getEnvironment().getProperty("user.age");
        System.err.println("user name :" +userName+"; age: "+userAge);
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Note that when your <code><code>spring-cloud-alibaba</code>&#8217;s version is <code>``2021.1</code></code>, since the <code><code>nacos</code></code> gets the configuration in the <code><code>bootstrap.yml </code></code> file Will be loaded before the <code><code>application.yml</code></code> file.
According to the official documentation of spring mentioned [bootstrap](<a href="https://docs.spring.io/spring-cloud-config/docs/current/reference/html/#config-first-bootstrap" class="bare">https://docs.spring.io/spring-cloud-config/docs/current/reference/html/#config-first-bootstrap</a>)
To solve this problem, we recommend that you add the following dependencies to the project root <code><code>pom.xml</code></code> file
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-starter-bootstrap&lt;/artifactId&gt;
    &lt;version&gt;3.1.1&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Before running this example, we need to configure the address of the Nacos server in bootstrap.properties. For example:</p>
</div>
<div class="listingblock">
<div class="title">bootstrap.properties</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="properties"># DataId By default, the `spring.application.name` configuration is combined with the file extension (the configuration format uses properties by default), and the GROUP is not configured to use DEFAULT_GROUP by default. Therefore, the Nacos Config configuration corresponding to the configuration file has a DataId of nacos-config.properties and a GROUP of DEFAULT_GROUP
spring.application.name=nacos-config
spring.cloud.nacos.config.server-addr=127.0.0.1:8848</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If you use domain name to access Nacos, the format of <code>spring.cloud.nacos.config.server-addr</code> should be <code>Domain name:port</code>.
For example, if the Nacos domain name is abc.com.nacos, and the listerner port is 80, then the configuration should be <code>spring.cloud.nacos.config.server-addr=abc.com.nacos:80</code>.
Port 80 cannot be omitted.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Run this example and you can see the following output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>2018-11-02 14:24:51.638  INFO 32700 --- [main] c.a.demo.provider.NacosConfigApplication    : Started NacosConfigApplication in 14.645 seconds (JVM running for 15.139)
user name :nacos-config-properties; age: 90
2018-11-02 14:24:51.688  INFO 32700 --- [-127.0.0.1:8848] s.c.a.AnnotationConfigApplicationContext : Refreshing org.springframework.context.annotation.AnnotationConfigApplicationContext@a8c5e74: startup date [Fri Nov 02 14:24:51 CST 2018]; root of context hierarchy</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_add_configurations_with_dataid_in_yaml_format">4.3. Add Configurations with DataId in YAML Format</h3>
<div class="paragraph">
<p>Nacos Config supports yaml format as well. You only need to complete the following 2 steps.</p>
</div>
<div class="paragraph">
<p>1、In the bootstrap.properties file, add the following line to claim that the format of DataId is yaml. As follows:</p>
</div>
<div class="listingblock">
<div class="title">bootstrap.properties</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="yaml">spring.cloud.nacos.config.file-extension=yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>2、Add a configuration with the DataId in yaml format on the Nacos console, as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>Data ID:        nacos-config.yaml

Group  :        DEFAULT_GROUP

Configuration format:        YAML

Configuration content:        user.name: nacos-config-yaml
                              user.age: 68</code></pre>
</div>
</div>
<div class="paragraph">
<p>After completing the preivous two steps, restart the testing program and you will see the following result.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>2018-11-02 14:59:00.484  INFO 32928 --- [main] c.a.demo.provider.NacosConfigApplication:Started NacosConfigApplication in 14.183 seconds (JVM running for 14.671)
user name :nacos-config-yaml; age: 68
2018-11-02 14:59:00.529  INFO 32928 --- [-127.0.0.1:8848] s.c.a.AnnotationConfigApplicationContext : Refreshing org.springframework.context.annotation.AnnotationConfigApplicationContext@265a478e: startup date [Fri Nov 02 14:59:00 CST 2018]; root of context hierarchy</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_support_dynamic_configuration_udpates">4.4. Support Dynamic Configuration Udpates</h3>
<div class="paragraph">
<p>Nacos Config also supports dynamic configuration updates. The code for starting Spring Boot application testing is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@SpringBootApplication
public class NacosConfigApplication {

    public static void main(String[] args) {
        ConfigurableApplicationContext applicationContext = SpringApplication.run(NacosConfigApplication.class, args);
        while(true) {
            //When configurations are refreshed dynamically, they will be updated in the Enviroment, therefore here we retrieve configurations from Environment every other second.
            String userName = applicationContext.getEnvironment().getProperty("user.name");
            String userAge = applicationContext.getEnvironment().getProperty("user.age");
            System.err.println("user name :" + userName + "; age: " + userAge);
            TimeUnit.SECONDS.sleep(1);
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When user.name is changed, the latest value can be retrieved from the application, as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>user name :nacos-config-yaml; age: 68
user name :nacos-config-yaml; age: 68
user name :nacos-config-yaml; age: 68
2018-11-02 15:04:25.069  INFO 32957 --- [-127.0.0.1:8848] o.s.boot.SpringApplication               : Started application in 0.144 seconds (JVM running for 71.752)
2018-11-02 15:04:25.070  INFO 32957 --- [-127.0.0.1:8848] s.c.a.AnnotationConfigApplicationContext : Closing org.springframework.context.annotation.AnnotationConfigApplicationContext@10c89124: startup date [Fri Nov 02 15:04:25 CST 2018]; parent: org.springframework.context.annotation.AnnotationConfigApplicationContext@6520af7
2018-11-02 15:04:25.071  INFO 32957 --- [-127.0.0.1:8848] s.c.a.AnnotationConfigApplicationContext : Closing org.springframework.context.annotation.AnnotationConfigApplicationContext@6520af7: startup date [Fri Nov 02 15:04:24 CST 2018]; root of context hierarchy
//Read the updated value from Enviroment
user name :nacos-config-yaml-update; age: 68
user name :nacos-config-yaml-update; age: 68</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You can disable automatic refresh with this setting`spring.cloud.nacos.config.refresh.enabled=false`.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_support_configurations_at_the_profile_level">4.5. Support configurations at the profile level</h3>
<div class="paragraph">
<p>When configurations are loaded by Nacos Config, basic configurations with  DataId of <code>${spring.application.name}. ${file-extension:properties}</code> , and DataId of <code>${spring.application.name}-${profile}. ${file-extension:properties}</code> are also loaded. If you need to use different configurations from different environments, you can use the <code>${spring.profiles.active}</code> configuration provided by Spring.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="properties">spring.profiles.active=develop</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
When specified in configuration files, ${spring.profiles.active} must be placed in bootstrap.properties.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Add a basic configuration in Nacos, with a DataId of nacos-config-develop.yaml, as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>Data ID:        nacos-config-develop.yaml

Group  :        DEFAULT_GROUP

Configuration format:        YAML

Configuration content:        current.env: develop-env</code></pre>
</div>
</div>
<div class="paragraph">
<p>Run the following Spring Boot application testing code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@SpringBootApplication
public class NacosConfigApplication {

    public static void main(String[] args) {
        ConfigurableApplicationContext applicationContext = SpringApplication.run(NacosConfigApplication.class, args);
        while(true) {
            String userName = applicationContext.getEnvironment().getProperty("user.name");
            String userAge = applicationContext.getEnvironment().getProperty("user.age");
            //Get the current deployment environment
            String currentEnv = applicationContext.getEnvironment().getProperty("current.env");
            System.err.println("in "+currentEnv+" enviroment; "+"user name :" + userName + "; age: " + userAge);
            TimeUnit.SECONDS.sleep(1);
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>After started, you can see the output as follows in the console:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>in develop-env enviroment; user name :nacos-config-yaml-update; age: 68
2018-11-02 15:34:25.013  INFO 33014 --- [ Thread-11] ConfigServletWebServerApplicationContext : Closing org.springframework.boot.web.servlet.context.AnnotationConfigServletWebServerApplicationContext@6f1c29b7: startup date [Fri Nov 02 15:33:57 CST 2018]; parent: org.springframework.context.annotation.AnnotationConfigApplicationContext@63355449</code></pre>
</div>
</div>
<div class="paragraph">
<p>To switch to the production environment, you only need to change the parameter of <code>${spring.profiles.active}</code>. As show below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="properties">spring.profiles.active=product</code></pre>
</div>
</div>
<div class="paragraph">
<p>At the same time, add the basic configuration with the DataId in the  Nacos of your production environment. For example, you can add the configuration with the DataId of nacos-config-product.yaml in Nacos of your production environment:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>Data ID:        nacos-config-product.yaml

Group  :        DEFAULT_GROUP

Configuration format:        YAML

Configuration content:        current.env: product-env</code></pre>
</div>
</div>
<div class="paragraph">
<p>Start the testing program and you will see the following result:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>in product-env enviroment; user name :nacos-config-yaml-update; age: 68
2018-11-02 15:42:14.628  INFO 33024 --- [Thread-11] ConfigServletWebServerApplicationContext : Closing org.springframework.boot.web.servlet.context.AnnotationConfigServletWebServerApplicationContext@6aa8e115: startup date [Fri Nov 02 15:42:03 CST 2018]; parent: org.springframework.context.annotation.AnnotationConfigApplicationContext@19bb07ed</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
In this example, we coded the configuration in the configuration file by using the <code>spring.profiles.active=&lt;profilename&gt;</code> method. In real scenarios, this variable needs to be different in different environment. You can use the <code>-Dspring.profiles.active=&lt;profile&gt;</code> parameter to specify the configuration so that you can switch between different environments easily.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_support_custom_namespaces">4.6. Support Custom Namespaces</h3>
<div class="paragraph">
<p>For details about namespaces in Nacos, refer to <a href="https://nacos.io/zh-cn/docs/concepts.html">Nacos Concepts</a></p>
</div>
<div class="quoteblock">
<blockquote>
Namespaces are used to isolate configurations for different tenants. Groups and Data IDs can be the same across different namespaces. Typical scenarios of namespaces is the isolation of configurations for different environments, for example, isolation between development/testing environments and production environments(configurations and services and so on).
</blockquote>
</div>
<div class="paragraph">
<p>The “Public” namespace of Nacos is used if no namespace is specified in <code>${spring.cloud.nacos.config.namespace}</code>. You can also specify a custom namespace in the following way：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="properties">spring.cloud.nacos.config.namespace=b3404bc0-d7dc-4855-b519-570ed34b62d7</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This configuration must be in the bootstrap.properties file. The value of <code>spring.cloud.nacos.config.namespace</code> is the id of the namespace, and the value of id can be retrieved from the Nacos console. Do not select other namespaces when adding configurations. Otherwise configurations cannot be retrieved properly.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_support_custom_groups">4.7. Support Custom Groups</h3>
<div class="paragraph">
<p>DEFAULT_GROUP is used by default when no <code>{spring.cloud.nacos.config.group}</code> configuration is defined. If you need to define your own group, you can define it in the following property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="properties">spring.cloud.nacos.config.group=DEVELOP_GROUP</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This configuration must be in the bootstrap.properties file, and the value of Group must be the same with the value of <code>spring.cloud.nacos.config.group</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_support_custom_data_id">4.8. Support Custom Data Id</h3>
<div class="paragraph">
<p>As of Spring Cloud Alibaba Nacos Config, data id can be self-defined. For detailed design of this part, refer to <a href="https://github.com/alibaba/spring-cloud-alibaba/issues/141">Github issue</a>.
The following is a complete sample:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="properties">spring.application.name=opensource-service-provider
spring.cloud.nacos.config.server-addr=127.0.0.1:8848

# config external configuration
# 1. Data Id is in the default group of DEFAULT_GROUP, and dynamic refresh of configurations is not supported.
spring.cloud.nacos.config.ext-config[0].data-id=ext-config-common01.properties

# 2. Data Id is not in the default group, and dynamic refresh of configurations is not supported.
spring.cloud.nacos.config.ext-config[1].data-id=ext-config-common02.properties
spring.cloud.nacos.config.ext-config[1].group=GLOBALE_GROUP

# 3. Data Id is not in the default group and dynamic referesh of configurations is supported.
spring.cloud.nacos.config.ext-config[2].data-id=ext-config-common03.properties
spring.cloud.nacos.config.ext-config[2].group=REFRESH_GROUP
spring.cloud.nacos.config.ext-config[2].refresh=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can see that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Support multiple data ids by configuring <code>spring.cloud.nacos.config.ext-config[n].data-id</code>.</p>
</li>
<li>
<p>Customize the group of data id by configuring <code>spring.cloud.nacos.config.ext-config[n].group</code>. If not specified,  DEFAULT_GROUP is used.</p>
</li>
<li>
<p>Control whether this data id supports dynamic refresh of configurations is supported when configurations are changed by configuring <code>spring.cloud.nacos.config.ext-config[n].refresh</code>.
It’s not supported by default.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
When multiple Data Ids are configured at the same time, the priority is defined by the value of “n” in <code>spring.cloud.nacos.config.ext-config[n].data-id</code>. The bigger the value, the higher the priority.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The value of <code>spring.cloud.nacos.config.ext-config[n].data-id</code> must have a file extension, and it could be properties or yaml/yml.
The setting in <code>spring.cloud.nacos.config.file-extension</code> does not have any impact on the custom Data Id file extension.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The configuration of custom Data Id allows the sharing of configurations among multiple applications, and also enables support of multiple configurations for one application.</p>
</div>
<div class="paragraph">
<p>To share the data id among multiple applications in a clearer manner, you can also use the following method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="properties">spring.cloud.nacos.config.shared-dataids=bootstrap-common.properties,all-common.properties
spring.cloud.nacos.config.refreshable-dataids=bootstrap-common.properties</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can see that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Multiple shared data ids can be configured using <code>spring.cloud.nacos.config.shared-dataids</code> , and the data ids are separted by commas.</p>
</li>
<li>
<p><code>spring.cloud.nacos.config.refreshable-dataids</code> is used to control which data ids will be refreshed dynamically when configurations are updated, and that the latest configuration values can be retrieved by applications. Data ids are separated with commas.
If not specified, all shared data ids will not be dynamically refreshed.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
When using <code>spring.cloud.nacos.config.shared-dataids</code> to configure multiple shared data ids,
we agree on the following priority between the shared configurations: Priorities are decided based on the order in which the configurations appear. The one that occurs later is higher in priority than the one that appears first.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
When using <code>spring.cloud.nacos.config.shared-dataids</code>, the data Id must have a file extension, and it could be properties or yaml/yml.
And the configuration in <code>spring.cloud.nacos.config.file-extension</code> does not have any impact on the customized Data Id file extension.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
When <code>spring.cloud.nacos.config.refreshable-dataids</code> specifies the data ids that support dynamic refresh, the corresponding values of the data ids should also specify file extensions.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_nacos_config_endpoint">4.9. Nacos Config Endpoint</h3>
<div class="paragraph">
<p>Nacos Config provides an Endpoint internally with a corresponding endpoint id of <code>nacos-config</code>.</p>
</div>
<div class="paragraph">
<p>Endpoint exposed json contains three properties:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Sources: Current application configuration data information</p>
</li>
<li>
<p>RefreshHistory: Configuration refresh history</p>
</li>
<li>
<p>NacosConfigProperties: Shows the current basic Nacos configurations of the current service</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The followings shows how a service instance accesses the Endpoint:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="json">{
	"NacosConfigProperties": {
		"serverAddr": "127.0.0.1:8848",
		"encode": null,
		"group": "DEFAULT_GROUP",
		"prefix": null,
		"fileExtension": "properties",
		"timeout": 3000,
		"endpoint": null,
		"namespace": null,
		"accessKey": null,
		"secretKey": null,
		"contextPath": null,
		"clusterName": null,
		"name": null,
		"sharedDataids": "base-common.properties,common.properties",
		"refreshableDataids": "common.properties",
		"extConfig": null
	},
	"RefreshHistory": [{
		"timestamp": "2019-07-29 11:20:04",
		"dataId": "nacos-config-example.properties",
		"md5": "7d5d7f1051ff6571e2ec9f90887d9d91"
	}],
	"Sources": [{
		"lastSynced": "2019-07-29 11:19:04",
		"dataId": "common.properties"
	}, {
		"lastSynced": "2019-07-29 11:19:04",
		"dataId": "base-common.properties"
	}, {
		"lastSynced": "2019-07-29 11:19:04",
		"dataId": "nacos-config-example.properties"
	}]
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_disable_nacos_config_autoconfiguration">4.10. Disable Nacos Config AutoConfiguration</h3>
<div class="paragraph">
<p>set spring.cloud.nacos.config.enabled = false to disable Spring Cloud Nacos Config AutoConfiguration.</p>
</div>
</div>
<div class="sect2">
<h3 id="_more_information_about_nacos_config_starter_configurations">4.11. More Information about Nacos Config Starter Configurations</h3>
<div class="paragraph">
<p>The following shows the other configurations of the starter of Nacos Config:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default Value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Server address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.nacos.config.server-addr</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IP and port of the Nacos Server listener</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dataid from nacos config</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.nacos.config.name</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">First take the prefix, then go to the name, and finally take spring.application.name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dataid from nacos config</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.nacos.config.prefix</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">First take the prefix, then go to the name, and finally take spring.application.name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Encode for nacos config content</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.nacos.config.encode</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Encode for nacos config content</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GROUP for nacos config</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.nacos.config.group</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DEFAULT_GROUP</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GROUP for nacos config</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">The suffix of nacos config dataId, also the file extension of config content.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.nacos.config.fileExtension</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>properties</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The suffix of nacos config dataId, also the file extension of config content(now support properties or yaml(yml))</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Timeout for get config from nacos</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.nacos.config.timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>3000</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Timeout for get config from nacos</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Endpoint</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.nacos.config.endpoint</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Endpoint</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Namespace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.nacos.config.namespace</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Namespace</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AccessKey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.nacos.config.accessKey</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alibaba Cloud account accesskey</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SecretKey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.nacos.config.secretKey</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alibaba Cloud account secretkey</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">The context path of Nacos Server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.nacos.config.contextPath</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The context path of Nacos Server</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cluster name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.nacos.config.clusterName</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cluster name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dataid for Shared Configuration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.nacos.config.sharedDataids</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dataid for Shared Configuration, split by ","</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dynamic refresh dataid for Shared Configuration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.nacos.config.refreshableDataids</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dynamic refresh dataid for Shared Configuration, split by ","</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom dataid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.nacos.config.extConfig</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">It&#8217;s a List，build up by <code>Config</code> POJO. <code>Config</code> has 3 attributes, <code>dataId</code>, <code>group</code> and <code>refresh</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_spring_cloud_alibaba_sentinel">5. Spring Cloud Alibaba Sentinel</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduction_of_sentinel">5.1. Introduction of Sentinel</h3>
<div class="paragraph">
<p>As microservices become popular, the stability of service calls is becoming increasingly important. <a href="https://github.com/alibaba/Sentinel">Sentinel</a> takes "flow" as the breakthrough point, and works on multiple fields including flow control, circuit breaking and load protection to protect service reliability.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/alibaba/Sentinel">Sentinel</a> has the following features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Rich Scenarios</strong>： Sentinel has supported the key scenarios of Alibaba’s Double 11 Shopping Festivals for over 10 years, such as second kill(i.e., controlling sudden bursts of traffic flow so that it’s within the acceptable range of the system capacity), message load shifting, circuit breaking of unreliable downstream applications.</p>
</li>
<li>
<p><strong>Comprehensive Real-Time Monitoring</strong>： Sentinel provides real-time monitoring capability. You can see the monitoring data of your servers at the accuracy of seconds, and even the overall runtime status of a cluster with less than 500 nodes.</p>
</li>
<li>
<p><strong>Extensive Open-Source Ecosystem</strong>： Sentinel provides out-of-box modules that can be easily integrated with other open-source frameworks/libraries, such as Spring Cloud, Dubbo, and gRPC. To use Sentinel, you only need to introduce the related dependency and make a few simple configurations.</p>
</li>
<li>
<p><strong>Sound SPI Extensions</strong>： Sentinel provides easy-to-use and sound SPI extension interfaces. You can customize logics with the SPI extensions quickly, for example, you can define your own rule management, or adapt to specific data sources.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_how_to_use_sentinel">5.2. How to Use Sentinel</h3>
<div class="paragraph">
<p>If you want to use Sentinel in your project, please use the starter with the group ID as <code>com.alibaba.cloud</code> and the artifact ID as <code>spring-cloud-starter-alibaba-sentinel</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-starter-alibaba-sentinel&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following is a simple example of how to use Sentinel:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@SpringBootApplication
public class Application {

    public static void main(String[] args) {
        SpringApplication.run(ServiceApplication.class, args);
    }

}

@RestController
public class TestController {

    @GetMapping(value = "/hello")
    @SentinelResource("hello")
    public String hello() {
        return "Hello Sentinel";
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The @SentinelResource annotation is used to identify if a resource is rate limited or degraded. In the above sample, the 'hello' attribute of the annotation refers to the resource name.</p>
</div>
<div class="paragraph">
<p>@SentinelResource also provides attributes such as <code>blockHandler</code>, <code>blockHandlerClass</code>,  and <code>fallback</code> to identify rate limiting or degradation operations. For more details, refer to  <a href="https://github.com/alibaba/Sentinel/wiki/%E6%B3%A8%E8%A7%A3%E6%94%AF%E6%8C%81">Sentinel Annotation Support</a>.</p>
</div>
<div class="paragraph">
<p>The above examples are all used in the WebServlet environment. Sentinel currently supports WebFlux and needs to cooperate with the <code>spring-boot-starter-webflux</code> dependency to trigger the WebFlux-related automation configuration in sentinel starter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@SpringBootApplication
public class Application {

    public static void main(String[] args) {
        SpringApplication.run(ServiceApplication.class, args);
    }

}

@RestController
public class TestController {

    @GetMapping("/mono")
    @SentinelResource("hello")
    public Mono&lt;String&gt; mono() {
	return Mono.just("simple string")
			.transform(new SentinelReactorTransformer&lt;&gt;("otherResourceName"));
    }

}</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_sentinel_dashboard">Sentinel Dashboard</h5>
<div class="paragraph">
<p>Sentinel dashboard is a lightweight console that provides functions such as machine discovery, single-server resource monitoring, overview of cluster resource data, as well as rule management. To use these features, you only need to complete a few steps.</p>
</div>
<div class="paragraph">
<p><strong>Note</strong>: The statistics overview for clusters only supports clusters with less than 500 nodes, and has a latency of about 1 to 2 seconds.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://github.com/alibaba/Sentinel/wiki/image/dashboard.png" alt="dashboard">
</div>
<div class="title">Figure 3. Sentinel Dashboard</div>
</div>
<div class="paragraph">
<p>To use the Sentinel dashboard, simply complete the following 3 steps.</p>
</div>
<div class="sect5">
<h6 id="_get_the_dashboard">Get the Dashboard</h6>
<div class="paragraph">
<p>You can download the latest dashboard JAR file from the <a href="https://github.com/alibaba/Sentinel/releases">Release Page</a>.</p>
</div>
<div class="paragraph">
<p>You can also get the latest source code to build your own Sentinel dashboard：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Download the  <a href="https://github.com/alibaba/Sentinel/tree/master/sentinel-dashboard">Dashboard</a> project.</p>
</li>
<li>
<p>Run the following command to package the code into a FatJar: <code>mvn clean package</code></p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_start_the_dashboard">Start the Dashboard</h6>
<div class="paragraph">
<p>Sentinel dashboard is a standard SpringBoot application, and you can run the JAR file in the Spring Boot mode.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="shell">java -Dserver.port=8080 -Dcsp.sentinel.dashboard.server=localhost:8080 -Dproject.name=sentinel-dashboard -jar sentinel-dashboard.jar</code></pre>
</div>
</div>
<div class="paragraph">
<p>If there is conflict with the 8080 port, you can use <code>-Dserver.port=new port</code> to define a new port.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_configure_the_dashboard">5.2.2. Configure the Dashboard</h4>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="yaml">spring:
  cloud:
    sentinel:
      transport:
        port: 8719
        dashboard: localhost:8080</code></pre>
</div>
</div>
<div class="paragraph">
<p>The port number specified in <code>spring.cloud.sentinel.transport.port</code> will start an HTTP Server on the corresponding server of the application, and this server will interact with the Sentinel dashboard. For example, if a rate limiting rule is added in the Sentinel dashboard, the the rule data will be pushed to and recieved by the HTTP Server, which in turn registers the rule to Sentinel.</p>
</div>
<div class="paragraph">
<p>For more information about Sentinel dashboard, please refer to <a href="https://github.com/alibaba/Sentinel/wiki/%E6%8E%A7%E5%88%B6%E5%8F%B0">Sentinel Dashboard</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_openfeign_support">5.3. OpenFeign Support</h3>
<div class="paragraph">
<p>Sentinel is compatible with the <a href="https://github.com/OpenFeign/feign">OpenFeign</a> component. To use it, in addition to introducing the <code>sentinel-starter</code> dependency, complete the following 2 steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Enable the Sentinel support for feign in the properties file. <code>feign.sentinel.enabled=true</code></p>
</li>
<li>
<p>Add the <code>openfeign starter</code> dependency to trigger and enable <code>sentinel starter</code>:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is a simple usage of <code>FeignClient</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@FeignClient(name = "service-provider", fallback = EchoServiceFallback.class, configuration = FeignConfiguration.class)
public interface EchoService {
    @GetMapping(value = "/echo/{str}")
    String echo(@PathVariable("str") String str);
}

class FeignConfiguration {
    @Bean
    public EchoServiceFallback echoServiceFallback() {
        return new EchoServiceFallback();
    }
}

class EchoServiceFallback implements EchoService {
    @Override
    public String echo(@PathVariable("str") String str) {
        return "echo fallback";
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The resource name policy in the corresponding interface of Feign is：httpmethod:protocol://requesturl. All the attributes in the <code>@FeignClient</code> annotation is supported by Sentinel.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The corresponding resource name of the <code>echo</code> method in the <code>EchoService</code> interface is <code>GET:http://service-provider/echo/{str}</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_resttemplate_support">5.4. RestTemplate Support</h3>
<div class="paragraph">
<p>Spring Cloud Alibaba Sentinel supports the protection of <code>RestTemplate</code> service calls using Sentinel. To do this, you need to add the <code>@SentinelRestTemplate</code> annotation when constructing the <code>RestTemplate</code> bean.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@Bean
@SentinelRestTemplate(blockHandler = "handleException", blockHandlerClass = ExceptionUtil.class)
public RestTemplate restTemplate() {
    return new RestTemplate();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The attribute of the <code>@SentinelRestTemplate</code> annotation support flow control(<code>blockHandler</code>, <code>blockHandlerClass</code>) and circuit breaking(<code>fallback</code>, <code>fallbackClass</code>).</p>
</div>
<div class="paragraph">
<p>==</p>
</div>
<div class="paragraph">
<p>The <code>blockHandler</code> or <code>fallback</code> is the static method of <code>blockHandlerClass</code> or <code>fallbackClass</code>.</p>
</div>
<div class="paragraph">
<p>The parameter and return value of method in <code>@SentinelRestTemplate</code> is same as <code>org.springframework.http.client.ClientHttpRequestInterceptor#interceptor</code>, but it has one more parameter <code>BlockException</code> to catch the exception by Sentinel.</p>
</div>
<div class="paragraph">
<p>The method signature of <code>handleException</code> in <code>ExceptionUtil</code> above should be like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public class ExceptionUtil {
    public static ClientHttpResponse handleException(HttpRequest request, byte[] body, ClientHttpRequestExecution execution, BlockException exception) {
        ...
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
When the application starts, it will check if the <code>@SentinelRestTemplate</code> annotation corresponding to the flow control or circuit breaking method exists, if it does not exist, it will throw an exception.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The attribute of the <code>@SentinelRestTemplate</code> annotation is optional.</p>
</div>
<div class="paragraph">
<p>It will return <code>RestTemplate request block by sentinel</code> when you using <code>RestTemplate</code> blocked by Sentinel. You can override it by your own logic. We provide <code>SentinelClientHttpResponse</code> to handle the response.</p>
</div>
<div class="paragraph">
<p>Sentinel RestTemplate provides two granularities for resource rate limiting:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>httpmethod:schema://host:port/path</code>： Protocol, host, port and path</p>
</li>
<li>
<p><code>httpmethod:schema://host:port</code>： Protocol, host and port</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Take Http GET <code><a href="https://www.taobao.com/test" class="bare">https://www.taobao.com/test</a></code> as an example. The corresponding resource names have two levels of granularities, <code>GET:https://www.taobao.com</code> and <code>GET:https://www.taobao.com/test</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_dynamic_data_source_support">5.5. Dynamic Data Source Support</h3>
<div class="paragraph">
<p><code>SentinelProperties</code> provide <code>datasource</code> attribute to configure datasource.</p>
</div>
<div class="paragraph">
<p>For example, 4 data sources are configures：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="properties">spring.cloud.sentinel.datasource.ds1.file.file=classpath: degraderule.json
spring.cloud.sentinel.datasource.ds1.file.rule-type=flow

#spring.cloud.sentinel.datasource.ds1.file.file=classpath: flowrule.json
#spring.cloud.sentinel.datasource.ds1.file.data-type=custom
#spring.cloud.sentinel.datasource.ds1.file.converter-class=JsonFlowRuleListConverter
#spring.cloud.sentinel.datasource.ds1.file.rule-type=flow

spring.cloud.sentinel.datasource.ds2.nacos.server-addr=127.0.0.1:8848
spring.cloud.sentinel.datasource.ds2.nacos.data-id=sentinel
spring.cloud.sentinel.datasource.ds2.nacos.group-id=DEFAULT_GROUP
spring.cloud.sentinel.datasource.ds2.nacos.data-type=json
spring.cloud.sentinel.datasource.ds2.nacos.rule-type=degrade

spring.cloud.sentinel.datasource.ds3.zk.path = /Sentinel-Demo/SYSTEM-CODE-DEMO-FLOW
spring.cloud.sentinel.datasource.ds3.zk.server-addr = localhost:2181
spring.cloud.sentinel.datasource.ds3.zk.rule-type=authority

spring.cloud.sentinel.datasource.ds4.apollo.namespace-name = application
spring.cloud.sentinel.datasource.ds4.apollo.flow-rules-key = sentinel
spring.cloud.sentinel.datasource.ds4.apollo.default-flow-rule-value = test
spring.cloud.sentinel.datasource.ds4.apollo.rule-type=param-flow</code></pre>
</div>
</div>
<div class="paragraph">
<p>This method follows the configuration of Spring Cloud Stream Binder. <code>TreeMap</code> is used for storage internally, and comparator is <code>String.CASE_INSENSITIVE_ORDER</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
d1, ds2, ds3, ds4 are the names of <code>ReadableDataSource</code>, and can be coded as you like. The <code>file</code>, <code>zk</code>, <code>nacos</code> , <code>apollo</code> refer to the specific data sources. The configurations following them are the specific configurations of these data sources respecitively.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Every data source has 3 common configuration items: <code>data-type</code>, <code>converter-class</code> and <code>rule-type</code>.</p>
</div>
<div class="paragraph">
<p><code>data-type</code> refers to <code>Converter</code>. Spring Cloud Alibaba Sentinel provides two embedded values by default: <code>json</code> and <code>xml</code> (the default is json if not specified). If you do not want to use the embedded <code>json</code> or <code>xml</code> <code>Converter</code>, you can also fill in <code>custom</code> to indicate that you will define your own <code>Converter</code>, and then configure the <code>converter-class</code>. You need to specify the full path of the class for this configuration.</p>
</div>
<div class="paragraph">
<p><code>rule-type</code> refers to the rule type in datasource(<code>flow</code>，<code>degrade</code>，<code>authority</code>，<code>system</code>, <code>param-flow</code>, <code>gw-flow</code>, <code>gw-api-group</code>).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
XML format is not supported by default. To make it effective, you need to add the  <code>jackson-dataformat-xml</code> dependency.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To learn more about how dynamic data sources work in Sentinel, refer to <a href="https://github.com/alibaba/Sentinel/wiki/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%99%E6%89%A9%E5%B1%95">Dynamic Rule Extension</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_support_spring_cloud_gateway">5.6. Support Spring Cloud Gateway</h3>
<div class="paragraph">
<p>Refer <a href="https://github.com/alibaba/Sentinel/wiki/API-Gateway-Flow-Control">API Gateway Flow Control</a></p>
</div>
<div class="paragraph">
<p>If you want to use Sentinel Starter with Spring Cloud Gateway, you need to add the <code>spring-cloud-alibaba-sentinel-gateway</code> dependency and add the <code>spring-cloud-starter-gateway</code> dependency to let Spring Cloud Gateway AutoConfiguration class in the module takes effect:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-starter-alibaba-sentinel&lt;/artifactId&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
    &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-alibaba-sentinel-gateway&lt;/artifactId&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-starter-gateway&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_circuit_breaker_spring_cloud_circuit_breaker_with_sentinel_configuring_sentinel_circuit_breakers">5.7. Circuit Breaker: Spring Cloud Circuit Breaker With Sentinel &amp; Configuring Sentinel Circuit Breakers</h3>
<div class="sect3">
<h4 id="_default_configuration">5.7.1. Default Configuration</h4>
<div class="paragraph">
<p>To provide a default configuration for all of your circuit breakers create a <code>Customizer</code> bean that is passed a
<code>SentinelCircuitBreakerFactory</code> or <code>ReactiveSentinelCircuitBreakerFactory</code>.
The <code>configureDefault</code> method can be used to provide a default configuration.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@Bean
public Customizer&lt;SentinelCircuitBreakerFactory&gt; defaultCustomizer() {
	return factory -&gt; factory.configureDefault(id -&gt; new SentinelConfigBuilder(id)
			.build());
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can choose to provide default circuit breaking rules via <code>SentinelConfigBuilder#rules(rules)</code>.
You can also choose to load circuit breaking rules later elsewhere using
<code>DegradeRuleManager.loadRules(rules)</code> API of Sentinel, or via Sentinel dashboard.</p>
</div>
<div class="sect4">
<h5 id="_reactive_example">Reactive Example</h5>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@Bean
public Customizer&lt;ReactiveSentinelCircuitBreakerFactory&gt; defaultCustomizer() {
	return factory -&gt; factory.configureDefault(id -&gt; new SentinelConfigBuilder(id)
			.build());
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_specific_circuit_breaker_configuration">5.7.2. Specific Circuit Breaker Configuration</h4>
<div class="paragraph">
<p>Similarly to providing a default configuration, you can create a <code>Customizer</code> bean this is passed a
<code>SentinelCircuitBreakerFactory</code>.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@Bean
public Customizer&lt;SentinelCircuitBreakerFactory&gt; slowCustomizer() {
	String slowId = "slow";
	List&lt;DegradeRule&gt; rules = Collections.singletonList(
		new DegradeRule(slowId).setGrade(RuleConstant.DEGRADE_GRADE_RT)
			.setCount(100)
			.setTimeWindow(10)
		);
	return factory -&gt; factory.configure(builder -&gt; builder.rules(rules), slowId);
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_reactive_example_2">Reactive Example</h5>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@Bean
public Customizer&lt;ReactiveSentinelCircuitBreakerFactory&gt; customizer() {
	List&lt;DegradeRule&gt; rules = Collections.singletonList(
		new DegradeRule().setGrade(RuleConstant.DEGRADE_GRADE_RT)
			.setCount(100)
			.setTimeWindow(10)
		);
	return factory -&gt; factory.configure(builder -&gt; builder.rules(rules), "foo", "bar");
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_sentinel_endpoint">5.8. Sentinel Endpoint</h3>
<div class="paragraph">
<p>Sentinel provides an Endpoint internally with a corresponding endpoint id of <code>sentinel</code>.</p>
</div>
<div class="paragraph">
<p>Endpoint exposed json contains multi properties:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>appName: application name</p>
</li>
<li>
<p>logDir: the directory of log</p>
</li>
<li>
<p>logUsePid: log name with pid ot not</p>
</li>
<li>
<p>blockPage: redirect page after sentinel block</p>
</li>
<li>
<p>metricsFileSize: the size of metrics file</p>
</li>
<li>
<p>metricsFileCharset: metrics file charset</p>
</li>
<li>
<p>totalMetricsFileCount: the total file count of of metrics file</p>
</li>
<li>
<p>consoleServer: sentinel dashboard address</p>
</li>
<li>
<p>clientIp: client ip</p>
</li>
<li>
<p>heartbeatIntervalMs: client heartbeat interval with dashboard</p>
</li>
<li>
<p>clientPort: the client needs to expose the port to interact with the dashboard</p>
</li>
<li>
<p>coldFactor: cold factor</p>
</li>
<li>
<p>filter: CommonFilter related properties, such as order, urlPatterns and enable</p>
</li>
<li>
<p>datasource: datasource configuration info by client</p>
</li>
<li>
<p>rules: the rule that the client takes effect internally contains flowRules, degradeRules, systemRules, authorityRule, paramFlowRule</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The followings shows how a service instance accesses the Endpoint:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="json">{
	"blockPage": null,
	"appName": "sentinel-example",
	"consoleServer": "localhost:8080",
	"coldFactor": "3",
	"rules": {
		"flowRules": [{
			"resource": "GET:http://www.taobao.com",
			"limitApp": "default",
			"grade": 1,
			"count": 0.0,
			"strategy": 0,
			"refResource": null,
			"controlBehavior": 0,
			"warmUpPeriodSec": 10,
			"maxQueueingTimeMs": 500,
			"clusterMode": false,
			"clusterConfig": null
		}, {
			"resource": "/test",
			"limitApp": "default",
			"grade": 1,
			"count": 0.0,
			"strategy": 0,
			"refResource": null,
			"controlBehavior": 0,
			"warmUpPeriodSec": 10,
			"maxQueueingTimeMs": 500,
			"clusterMode": false,
			"clusterConfig": null
		}, {
			"resource": "/hello",
			"limitApp": "default",
			"grade": 1,
			"count": 1.0,
			"strategy": 0,
			"refResource": null,
			"controlBehavior": 0,
			"warmUpPeriodSec": 10,
			"maxQueueingTimeMs": 500,
			"clusterMode": false,
			"clusterConfig": null
		}]
	},
	"metricsFileCharset": "UTF-8",
	"filter": {
		"order": -2147483648,
		"urlPatterns": ["/*"],
		"enabled": true
	},
	"totalMetricsFileCount": 6,
	"datasource": {
		"ds1": {
			"file": {
				"dataType": "json",
				"ruleType": "FLOW",
				"converterClass": null,
				"file": "...",
				"charset": "utf-8",
				"recommendRefreshMs": 3000,
				"bufSize": 1048576
			},
			"nacos": null,
			"zk": null,
			"apollo": null,
			"redis": null
		}
	},
	"clientIp": "30.5.121.91",
	"clientPort": "8719",
	"logUsePid": false,
	"metricsFileSize": 52428800,
	"logDir": "...",
	"heartbeatIntervalMs": 10000
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configuration">5.9. Configuration</h3>
<div class="paragraph">
<p>The following table shows that when there are corresponding bean types in <code>ApplicationContext</code>, some actions will be taken:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Existing Bean Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Action</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Function</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UrlCleaner</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>WebCallbackManager.setUrlCleaner(urlCleaner)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resource cleaning(resource(for example, classify all URLs of /foo/:id to the  /foo/* resource))</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UrlBlockHandler</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>WebCallbackManager.setUrlBlockHandler(urlBlockHandler)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Customize rate limiting logic</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RequestOriginParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>WebCallbackManager.setRequestOriginParser(requestOriginParser)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Setting the origin</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following table shows all the configurations of Spring Cloud Alibaba Sentinel:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default Value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.application.name</code> or <code>project.name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Project Name Of Sentinel</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.sentinel.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether Sentinel automatic configuration takes effect</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.sentinel.eager</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to trigger Sentinel initialization in advance</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.sentinel.transport.port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Port for the application to interact with Sentinel dashboard. An HTTP Server which uses this port will be started in the application</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8719</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.sentinel.transport.dashboard</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sentinel dashboard address</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.sentinel.transport.heartbeatIntervalMs</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hearbeat interval between the application and Sentinel dashboard</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.sentinel.transport.client-ip</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The client IP of this configuration will be registered to the Sentinel Server side.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.sentinel.filter.order</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Loading order of Servlet Filter. The filter will be constructed in the Starter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer.MIN_VALUE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.sentinel.filter.url-patterns</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Data type is array. Refers to the collection of Servlet Filter ULR patterns</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/*</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.sentinel.filter.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable to instance CommonFilter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.sentinel.metric.charset</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">metric file character set</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UTF-8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.sentinel.metric.fileSingleSize</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sentinel metric single file size</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.sentinel.metric.fileTotalCount</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sentinel metric total file number</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.sentinel.log.dir</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Directory of Sentinel log files</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.sentinel.log.switch-pid</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If PID is required for Sentinel log file names</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.sentinel.servlet.blockPage</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Customized redirection URL. When rate limited, the request will be redirected to the pre-defined URL</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.sentinel.flow.coldFactor</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/alibaba/Sentinel/wiki/%E9%99%90%E6%B5%81---%E5%86%B7%E5%90%AF%E5%8A%A8">ColdFactor</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.sentinel.scg.fallback.mode</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Response mode after Spring Cloud Gateway circuit break (select <code>redirect</code> or <code>response</code>)</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.sentinel.scg.fallback.redirect</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Spring Cloud Gateway response mode is the redirect URL corresponding to 'redirect' mode</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.sentinel.scg.fallback.response-body</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Spring Cloud Gateway response mode is response content corresponding to 'response' mode</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.sentinel.scg.fallback.response-status</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Spring Cloud Gateway response mode is the response code corresponding to 'response' mode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">429</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.sentinel.scg.fallback.content-type</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Spring Cloud Gateway response mode is the content-type corresponding to the 'response' mode.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/json</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
These configurations will only take effect in servlet environment. RestTemplate and Feign will not take effect for these configurations.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_spring_cloud_alibaba_rocketmq_binder">6. Spring Cloud Alibaba RocketMQ Binder</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduction_of_rocketmq">6.1. Introduction of RocketMQ</h3>
<div class="paragraph">
<p><a href="https://rocketmq.apache.org">RocketMQ</a> is an open-source distributed message system. It is based on highly available distributed cluster technologies and provides message publishing and subscription service with low latency and high stability. RocketMQ is widely used in a variety of industries, such as decoupling of asynchronous communication, enterprise solutions, financial settlements, telecommunication, e-commerce, logistics, marketing, social media, instant messaging, mobile applications, mobile games, videos, IoT, and Internet of Vehicles.</p>
</div>
<div class="paragraph">
<p>It has the following features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Strict order of message sending and consumption</p>
</li>
<li>
<p>Rich modes of message pulling</p>
</li>
<li>
<p>Horizontal scalability of consumers</p>
</li>
<li>
<p>Real-time message subscription</p>
</li>
<li>
<p>Billion-level message accumulation capability</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_rocketmq_usages">6.2. RocketMQ Usages</h3>
<div class="ulist">
<ul>
<li>
<p>Download RocketMQ</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Download <a href="https://www.apache.org/dyn/closer.cgi?path=rocketmq/4.3.2/rocketmq-all-4.3.2-bin-release.zip">Latest Binary File of RocketMQ</a>, and decompress it.</p>
</div>
<div class="paragraph">
<p>The decompressed directory is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>apache-rocketmq
├── LICENSE
├── NOTICE
├── README.md
├── benchmark
├── bin
├── conf
└── lib</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Start NameServer</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="bash">nohup sh bin/mqnamesrv &amp;
tail -f ~/logs/rocketmqlogs/namesrv.log</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Start Broker</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="bash">nohup sh bin/mqbroker -n localhost:9876 &amp;
tail -f ~/logs/rocketmqlogs/broker.log</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Send and Receive Messages</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Send messages:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="bash">sh bin/tools.sh org.apache.rocketmq.example.quickstart.Producer</code></pre>
</div>
</div>
<div class="paragraph">
<p>Output when the message is successfully sent: <code>SendResult [sendStatus=SEND_OK, msgId= &#8230;&#8203;</code></p>
</div>
<div class="paragraph">
<p>Receive messages:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="bash">sh bin/tools.sh org.apache.rocketmq.example.quickstart.Consumer</code></pre>
</div>
</div>
<div class="paragraph">
<p>Output when the message is successfully received： <code>ConsumeMessageThread_%d Receive New Messages: [MessageExt&#8230;&#8203;</code></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Disable Server</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="bash">sh bin/mqshutdown broker
sh bin/mqshutdown namesrv</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_introduction_of_spring_cloud_stream">6.3. Introduction of Spring Cloud Stream</h3>
<div class="paragraph">
<p>Spring Cloud Stream is a microservice framework used to build architectures based on messages. It helps you to create production-ready single-server Spring applications based on SpringBoot, and connects with Broker using <code>Spring Integration</code>.</p>
</div>
<div class="paragraph">
<p>Spring Cloud Stream provides unified abstractions of message middleware configurations, and puts forward concepts such as publish-subscribe, consumer groups and partition.</p>
</div>
<div class="paragraph">
<p>There are two concepts in Spring Cloud Stream: Binder and Binding</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Binder: A component used to integrate with external message middleware, and is used to create binding. Different message middleware products have their own binder implementations.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, <code>Kafka</code> uses <code>KafkaMessageChannelBinder</code>, <code>RabbitMQ</code> uses <code>RabbitMessageChannelBinder</code>, while <code>RocketMQ</code> uses <code>RocketMQMessageChannelBinder</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Binding: Includes Input Binding and Output Binding.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Binding serves as a bridge between message middleware and the provider and consumer of the applications. Developers only need to use the Provider or Consumer to produce or consume data, and do not need to worry about the interactions with the message middleware.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://docs.spring.io/spring-cloud-stream/docs/current/reference/htmlsingle/images/SCSt-overview.png" alt="SCSt overview">
</div>
<div class="title">Figure 4. Spring Cloud Stream</div>
</div>
<div class="paragraph">
<p>Now let’s use Spring Cloud Stream to write a simple code for sending and receiving messages:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">MessageChannel messageChannel = new DirectChannel();

// Message subscription
((SubscribableChannel) messageChannel).subscribe(new MessageHandler() {
    @Override
    public void handleMessage(Message&lt;? &gt; message) throws MessagingException {
        System.out.println("receive msg: " + message.getPayload());
    }
});

// Message sending
messageChannel.send(MessageBuilder.withPayload("simple msg").build());</code></pre>
</div>
</div>
<div class="paragraph">
<p>All the message types in this code are provided by the `spring-messaging`module. It shields the lower-layer implementations of message middleware. If you would like to change the message middleware, you only need to configure the related message middleware information in the configuration file and modify the binder dependency.</p>
</div>
<div class="paragraph">
<p><strong>The lower layer of Spring Cloud Stream also implements various code abstractions based on the previous code.</strong></p>
</div>
</div>
<div class="sect2">
<h3 id="_how_to_use_spring_cloud_alibaba_rocketmq_binder">6.4. How to use Spring Cloud Alibaba RocketMQ Binder</h3>
<div class="paragraph">
<p>For using the Spring Cloud Alibaba RocketMQ Binder, you just need to add it to your Spring Cloud Stream application, using the following Maven coordinates:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;
  &lt;artifactId&gt;spring-cloud-stream-binder-rocketmq&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, you can also use the Spring Cloud Stream RocketMQ Starter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-starter-stream-rocketmq&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_how_spring_cloud_alibaba_rocketmq_binder_works">6.5. How Spring Cloud Alibaba RocketMQ Binder Works</h3>
<div class="paragraph">
<p>This is the implementation architecture of Spring Cloud Stream RocketMQ Binder:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://img.alicdn.com/tfs/TB1v8rcbUY1gK0jSZFCXXcwqXXa-1236-773.png" alt="TB1v8rcbUY1gK0jSZFCXXcwqXXa 1236 773">
</div>
<div class="title">Figure 5. SCS RocketMQ Binder</div>
</div>
<div class="paragraph">
<p>The implementation of RocketMQ Binder depend on the <a href="https://github.com/apache/rocketmq-spring">RocketMQ-Spring</a> framework.</p>
</div>
<div class="paragraph">
<p>RocketMQ Spring framework is an integration of RocketMQ and Spring Boot. It provides three main features:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>RocketMQTemplate</code>: Sending messages, including synchronous, asynchronous, and transactional messages.</p>
</li>
<li>
<p><code>@RocketMQTransactionListener</code>: Listen and check for transaction messages.</p>
</li>
<li>
<p><code>@RocketMQMessageListener</code>: Consume messages.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><code>RocketMQMessageChannelBinder</code> is a standard implementation of Binder, it will build <code>RocketMQInboundChannelAdapter</code> and <code>RocketMQMessageHandler</code> internally.</p>
</div>
<div class="paragraph">
<p><code>RocketMQMessageHandler</code> will construct <code>RocketMQTemplate</code> based on the Binding configuration. <code>RocketMQTemplate</code> will convert the <code>org.springframework.messaging.Message</code> message class of <code>spring-messaging</code> module to the RocketMQ message class <code>org.apache.rocketmq.common .message.Message</code> internally, then send it out.</p>
</div>
<div class="paragraph">
<p><code>RocketMQInboundChannelAdapter</code> will also construct <code>RocketMQListenerBindingContainer</code> based on the Binding configuration, and <code>RocketMQListenerBindingContainer</code> will start the RocketMQ <code>Consumer</code> to receive the messages.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
RocketMQ Binder Application can also be used to configure rocketmq.** to trigger RocketMQ Spring related AutoConfiguration
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Currently Binder supports setting the relevant key in <code>Header</code> to set the properties of the RocketMQ message.</p>
</div>
<div class="paragraph">
<p>For example, <code>TAGS</code>, <code>DELAY</code>, <code>TRANSACTIONAL_ARG</code>, <code>KEYS</code>, <code>WAIT_STORE_MSG_OK</code>, <code>FLAG</code> represent the labels corresponding to the RocketMQ message.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">MessageBuilder builder = MessageBuilder.withPayload(msg)
    .setHeader(RocketMQHeaders.TAGS, "binder")
    .setHeader(RocketMQHeaders.KEYS, "my-key")
    .setHeader(MessageConst.PROPERTY_DELAY_TIME_LEVEL, "1");
Message message = builder.build();
output().send(message);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or use StreamBridge</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">MessageBuilder builder = MessageBuilder.withPayload(msg)
    .setHeader(RocketMQHeaders.TAGS, "binder")
    .setHeader(RocketMQHeaders.KEYS, "my-key")
    .setHeader(MessageConst.PROPERTY_DELAY_TIME_LEVEL, "1");
Message message = builder.build();
streamBridge.send("producer-out-0", message);</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
More Examples: <a href="https://github.com/alibaba/spring-cloud-alibaba/tree/2021.x/spring-cloud-alibaba-examples/rocketmq-example">RocketMQ Example</a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_options">6.6. Configuration Options</h3>
<div class="sect3">
<h4 id="_rocketmq_binder_properties">6.6.1. RocketMQ Binder Properties</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">spring.cloud.stream.rocketmq.binder.name-server</dt>
<dd>
<p>The name server of RocketMQ Server(Older versions use the namesrv-addr configuration item).</p>
<div class="paragraph">
<p>Default: <code>127.0.0.1:9876</code>.</p>
</div>
</dd>
<dt class="hdlist1">spring.cloud.stream.rocketmq.binder.access-key</dt>
<dd>
<p>The AccessKey of Alibaba Cloud Account.</p>
<div class="paragraph">
<p>Default: null.</p>
</div>
</dd>
<dt class="hdlist1">spring.cloud.stream.rocketmq.binder.secret-key</dt>
<dd>
<p>The SecretKey of Alibaba Cloud Account.</p>
<div class="paragraph">
<p>Default: null.</p>
</div>
</dd>
<dt class="hdlist1">spring.cloud.stream.rocketmq.binder.enable-msg-trace</dt>
<dd>
<p>Enable Message Trace feature for all producers and consumers.</p>
<div class="paragraph">
<p>Default: <code>true</code>.</p>
</div>
</dd>
<dt class="hdlist1">spring.cloud.stream.rocketmq.binder.customized-trace-topic</dt>
<dd>
<p>The trace topic for message trace.</p>
<div class="paragraph">
<p>Default: <code>RMQ_SYS_TRACE_TOPIC</code>.</p>
</div>
</dd>
<dt class="hdlist1">spring.cloud.stream.rocketmq.binder.access-channel</dt>
<dd>
<p>The commercial version of rocketmq message trajectory topic is adaptive,the value is CLOUD</p>
<div class="paragraph">
<p>Default: null.</p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_rocketmq_consumer_properties">6.6.2. RocketMQ Consumer Properties</h4>
<div class="paragraph">
<p>The following properties are available for RocketMQ producers only and must be prefixed with <code>spring.cloud.stream.rocketmq.bindings.&lt;channelName&gt;.consumer.</code>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">enable</dt>
<dd>
<p>Enable Consumer Binding.</p>
<div class="paragraph">
<p>Default: <code>true</code>.</p>
</div>
</dd>
<dt class="hdlist1">tags</dt>
<dd>
<p>Consumer subscription tags expression, tags split by <code>||</code>.</p>
<div class="paragraph">
<p>Default: empty.</p>
</div>
</dd>
<dt class="hdlist1">sql</dt>
<dd>
<p>Consumer subscription sql expression.</p>
<div class="paragraph">
<p>Default: empty.</p>
</div>
</dd>
<dt class="hdlist1">broadcasting</dt>
<dd>
<p>Control message mode, if you want all subscribers receive message all message, broadcasting is a good choice.</p>
<div class="paragraph">
<p>Default: <code>false</code>.</p>
</div>
</dd>
<dt class="hdlist1">orderly</dt>
<dd>
<p>Receiving message concurrently or orderly.</p>
<div class="paragraph">
<p>Default: <code>false</code>.</p>
</div>
</dd>
<dt class="hdlist1">delayLevelWhenNextConsume</dt>
<dd>
<p>Message consume retry strategy for concurrently consume:</p>
<div class="ulist">
<ul>
<li>
<p>-1,no retry,put into DLQ directly</p>
</li>
<li>
<p>0,broker control retry frequency</p>
</li>
<li>
<p>&gt;0,client control retry frequency</p>
<div class="paragraph">
<p>Default: <code>0</code>.</p>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">suspendCurrentQueueTimeMillis</dt>
<dd>
<p>Time interval of message consume retry for orderly consume.</p>
<div class="paragraph">
<p>Default: <code>1000</code>.</p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_rocketmq_provider_properties">6.6.3. RocketMQ Provider Properties</h4>
<div class="paragraph">
<p>The following properties are available for RocketMQ producers only and must be prefixed with <code>spring.cloud.stream.rocketmq.bindings.&lt;channelName&gt;.producer.</code>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">enable</dt>
<dd>
<p>Enable Producer Binding.</p>
<div class="paragraph">
<p>Default: <code>true</code>.</p>
</div>
</dd>
<dt class="hdlist1">group</dt>
<dd>
<p>Producer group name.</p>
<div class="paragraph">
<p>Default: empty.</p>
</div>
</dd>
<dt class="hdlist1">maxMessageSize</dt>
<dd>
<p>Maximum allowed message size in bytes.</p>
<div class="paragraph">
<p>Default: <code>8249344</code>.</p>
</div>
</dd>
<dt class="hdlist1">transactional</dt>
<dd>
<p>Send Transactional Message.</p>
<div class="paragraph">
<p>Default: <code>false</code>.</p>
</div>
</dd>
<dt class="hdlist1">sync</dt>
<dd>
<p>Send message in synchronous mode.</p>
<div class="paragraph">
<p>Default: <code>false</code>.</p>
</div>
</dd>
<dt class="hdlist1">vipChannelEnabled</dt>
<dd>
<p>Send message with vip channel.</p>
<div class="paragraph">
<p>Default: <code>true</code>.</p>
</div>
</dd>
<dt class="hdlist1">sendMessageTimeout</dt>
<dd>
<p>Millis of send message timeout.</p>
<div class="paragraph">
<p>Default: <code>3000</code>.</p>
</div>
</dd>
<dt class="hdlist1">compressMessageBodyThreshold</dt>
<dd>
<p>Compress message body threshold, namely, message body larger than 4k will be compressed on default.</p>
<div class="paragraph">
<p>Default: <code>4096</code>.</p>
</div>
</dd>
<dt class="hdlist1">retryTimesWhenSendFailed</dt>
<dd>
<p>Maximum number of retry to perform internally before claiming sending failure in synchronous mode.</p>
<div class="paragraph">
<p>Default: <code>2</code>.</p>
</div>
</dd>
<dt class="hdlist1">retryTimesWhenSendAsyncFailed</dt>
<dd>
<p>Maximum number of retry to perform internally before claiming sending failure in asynchronous mode.</p>
<div class="paragraph">
<p>Default: <code>2</code>.</p>
</div>
</dd>
<dt class="hdlist1">retryNextServer</dt>
<dd>
<p>Indicate whether to retry another broker on sending failure internally.</p>
<div class="paragraph">
<p>Default: <code>false</code>.</p>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_spring_cloud_alibaba_cloud_ans">7. Spring Cloud Alibaba Cloud ANS</h2>
<div class="sectionbody">
<div class="paragraph">
<p>ANS(Application Naming Service) is a component of EDAS.  Spring Cloud Alibaba Cloud ANS provides the commercial version of service registration and discovery in conformity with the Spring Cloud specifications, so that you can develop your applications locally and run them on the cloud.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
EDAS currently supports direct deployment of Nacos Discovery applications
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_how_to_introduce_spring_cloud_alibaba_cloud_ans">7.1. How to Introduce Spring Cloud Alibaba Cloud ANS</h3>
<div class="paragraph">
<p>If you want to use ANS in your project, please use the starter with the group ID as <code>com.alibaba.cloud</code> and the artifact ID as <code>spring-cloud-starter-alicloud-ans</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-starter-alicloud-ans&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_use_ans_to_register_service">7.2. Use ANS to Register Service</h3>
<div class="paragraph">
<p>When Spring Cloud AliCloud ANS Starter is introduced on the client, the metadata of the service such as IP, port number and weight will be registered to the registration center automatically. The client will maintain heartbeat with the server to prove that it is capable of providing service properly.</p>
</div>
<div class="paragraph">
<p>The following is a simple illustration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@SpringBootApplication
@EnableDiscoveryClient
@RestController
public class ProviderApplication {

    @RequestMapping("/")
    public String home() {
        return "Hello world";
    }

    public static void main(String[] args) {
        SpringApplication.run(ProviderApplication.class, args);
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As the service will registered to the registration center, we will need to configure the address of the registration center. We also need to add the following address in application.properties.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="properties"># The application name will be used as the service name, therefore it is mandatory.
spring.application.name=ans-provider
server.port=18081
# The following is the IP and port number of the registration center.
spring.cloud.alicloud.ans.server-list=127.0.0.1
spring.cloud.alicloud.ans.server-port=8080</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
By now the registration center is not started yet, so you will get an error message if your application is started. Therefore, start the registration center before you start your application.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_start_registration_center">7.3. Start Registration Center</h3>
<div class="paragraph">
<p>ANS uses two types of registration centers. One is the free lightweight configuration center and the other is the registration center on cloud, which is provided through EDAS. Generally, you can use the lightweight version for application development and local testing, and use EDAS for canary deployment or production.</p>
</div>
<div class="sect3">
<h4 id="_start_lightweight_configuration_center">7.3.1. Start Lightweight Configuration Center</h4>
<div class="paragraph">
<p>Refer to the <a href="https://help.aliyun.com/document_detail/44163.html">Configure Lightweight Configuration Center</a> for details about how to download and install lightweight configuration center.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You only need to perform step 1(Download lightweight configuration center) and step 2(Start lightweight configuration center). Step 3(Configure hosts) is not required if you use ANS at the same time.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>After you start the lightweight configuration center, start ProviderApplication directly, and you will be able to register your service to the configuration center. The default port of the lightweight configuration center is 8080, therefore you can open <a href="http://127.0.0.1:8080" class="bare">http://127.0.0.1:8080</a>, click “Services” on the left and see the registered service.</p>
</div>
</div>
<div class="sect3">
<h4 id="_user_registration_center_on_the_cloud">7.3.2. User Registration Center on the Cloud</h4>
<div class="paragraph">
<p>Using the registration center on the cloud saves you from the tedious work of server maintenance while at the same time provides a better stability. There is no difference at the code level between using the registration center on cloud and lightweight configuration center, but there are some differences in configurations.</p>
</div>
<div class="paragraph">
<p>The following is a simple sample of using the registration center on the cloud.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="properties"># The application name will be used the service name, and is therefore mandatory.
spring.application.name=ans-provider
# Configure your own port number
server.port=18081
# The following is the IP and port number of the configuration center. The default value is 127.0.0.1 and 8080, so the following lines can be omitted.
spring.cloud.alicloud.ans.server-mode=EDAS
spring.cloud.alicloud.access-key=Your Alibaba Cloud AK
spring.cloud.alicloud.secret-key=Your Alibaba Cloud SK
spring.cloud.alicloud.edas.namespace=cn-xxxxx</code></pre>
</div>
</div>
<div class="paragraph">
<p>The default value of server-mode is LOCAL. If you want to use the registration center on cloud, you need to change it to EDAS.</p>
</div>
<div class="paragraph">
<p>Access-key and secret-key are the AK/SK of your Alibaba Cloud account. Register an Alibaba Cloud account first and log on to the Cloud Console <a href="https://usercenter.console.aliyun.com/#/manage/ak">Alibaba Cloud AK/SK</a>  to copy your AccessKey ID and Access Key Secret. If you haven’t created one, click the “Create AccessKey” button.</p>
</div>
<div class="paragraph">
<p>Namespace is a concept in EDAS, which is used to isolate environments, such as testing environment and production environment. To find your namespace, click to <a href="https://common-buy.aliyun.com/?spm=5176.11451019.0.0.6f5965c0Uq5tue&amp;commodityCode=edaspostpay#/buy">Sign up for EDAS</a> first. You will not be charged under the pay-as-you-go mode. Then log on to the <a href="https://edas.console.aliyun.com/#/namespaces?regionNo=cn-hangzhou">EDAS Console</a> and you will be able to see your namespace, for example cn-hangzhou.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
EDAS provides application hosting service and will fill in all configurations automatically for the hosted applications.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_spring_cloud_alibaba_cloud_acm">8. Spring Cloud Alibaba Cloud ACM</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Cloud AliCloud ACM is an implementation of the commercial product Application Configuration Management(ACM) in the client side of Spring Cloud, and is free of charge.</p>
</div>
<div class="paragraph">
<p>Use Spring Cloud AliCloud ACM to quickly access ACM configuration management capabilities based on Spring Cloud&#8217;s programming model.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Currently EDAS already supports direct deployment of the Nacos Config app.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_how_to_introduce_spring_cloud_alibaba_cloud_acm">8.1. How to Introduce Spring Cloud Alibaba Cloud ACM</h3>
<div class="paragraph">
<p>If you want to use ACM in your project, please use the starter with the group ID as <code>com.alibaba.cloud</code> and the artifact ID as <code>spring-cloud-starter-alicloud-acm</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-starter-alicloud-acm&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_use_acm_to_manage_configurations">8.2. Use ACM to Manage Configurations</h3>
<div class="paragraph">
<p>When Spring Cloud Alibaba Cloud ACM Starter is introduced into the client, the application will automatically get configuration information from the configuration management server when it starts, and inject the configuration into Spring Environment.</p>
</div>
<div class="paragraph">
<p>The following is a simple illustration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@SpringBootApplication
public class ProviderApplication {

    public static void main(String[] args) {
        ConfigurableApplicationContext applicationContext = SpringApplication.run(ProviderApplication.class, args);
        String userName = applicationContext.getEnvironment().getProperty("user.name");
        String userAge = applicationContext.getEnvironment().getProperty("user.age");
        System.err.println("user name :" +userName+"; age: "+userAge);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As we need to obtain configuration information from the configuration server, we will need to configure the address of the server. We also need to add the following information in bootstrap.properties.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="properties"># Required. The application name will be used as part of the keyword to get the configuration key from the server.
spring.application.name=acm-config
server.port=18081
# The following is the IP and port number of the configuration server.
spring.cloud.alicloud.acm.server-list=127.0.0.1
spring.cloud.alicloud.acm.server-port=8080</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
By now the configuration center is not started yet, so you will get an error message if your application is started. Therefore, start the configuration center before you start your application.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_start_configuration_center">8.2.1. Start Configuration Center</h4>
<div class="paragraph">
<p>ACM uses two types of configuration centers. One is lightweight configuration center, the other is ACM which is used on Alibaba Cloud. Generally, you can use the lightweight version for application development and local testing, and use ACM for canary deployment or production.</p>
</div>
<div class="sect4">
<h5 id="_use_lightweight_configuration_center">Use Lightweight Configuration Center</h5>
<div class="paragraph">
<p>Refer to the <a href="https://help.aliyun.com/document_detail/44163.html">Configure Lightweight Configuration Center</a> for details about how to download and install lightweight configuration center.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You only need to perform step 1(Download lightweight configuration center) and step 2(Start lightweight configuration center).
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_use_acm_on_the_alibaba_cloud">Use ACM on the Alibaba Cloud</h5>
<div class="paragraph">
<p>Using ACM on the cloud saves you from the tedious work of server maintenance while at the same time provides a better stability. There is no difference at the code level between using ACM on cloud and lightweight configuration center, but there are some differences in configurations.</p>
</div>
<div class="paragraph">
<p>The following is a simple sample of using ACM. You can view configuration details on <a href="https://acm.console.aliyun.com">ACM Console</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="properties"># The application name will be used as part of the keyword to obtain configuration key from the server, and is mandatory.
spring.application.name=acm-config
# Configure your own port number
server.port=18081
# The following is the IP and port number of the configuration center.
spring.cloud.alicloud.acm.server-mode=EDAS
spring.cloud.alicloud.access-key=Your Alibaba Cloud AK
spring.cloud.alicloud.secret-key=Your Alibaba Cloud SK
spring.cloud.alicloud.acm.endpoint=acm.aliyun.com
spring.cloud.alicloud.acm.namespace=Your ACM namespace(You can find the namespace on the ACM console)</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
EDAS provides application hosting service and will fill in all configurations about ACM automatically for the hosted applications.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_add_configuration_in_the_configuration_center">8.2.2. Add Configuration in the Configuration Center</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>After you start the lightweight configuration center, add the following configuration on the console.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>Group:      DEFAULT_GROOUP

DataId:     acm-config.properties

Content:    user.name=james
            user.age=18</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The format of dataId is <code>{prefix}. {file-extension}</code>. “prefix” is obtained from spring.application.name by default, and the value of “file-extension” is "properties” by default.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_start_application_verification">8.2.3. Start Application Verification</h4>
<div class="paragraph">
<p>Start the following example and you can see that the value printed on the console is the value we configured in the lightweight configuration center.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>user name :james; age: 18</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_modify_configuration_file_extension">8.3. Modify Configuration File Extension</h3>
<div class="paragraph">
<p>The default file extension of dataId in spring-cloud-starter-alicloud-acm is properties. In addition to properties,  yaml is also supported.
You can set the file extension using spring.cloud.alicloud.acm.file-extension. Just set it to <code>yaml</code> or `yml`for yaml format.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
After you change the file extension, you need to make corresponding format changes in the DataID and content of the configuration center.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_dynamic_configuration_refresh">8.4. Dynamic Configuration Refresh</h3>
<div class="paragraph">
<p>spring-cloud-starter-alicloud-acm supports dynamic configuration updates. RefreshEvent in Spring is published when you update configuration in the configuration center.
All classes with @RefreshScope and @ConfigurationProperties annotations will be refreshed automatically.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You can disable automatic refresh by this setting: spring.cloud.alicloud.acm.refresh.enabled=false
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_configure_profile_granularity">8.5. Configure Profile Granularity</h3>
<div class="paragraph">
<p>When configuration is loaded by spring-cloud-starter-alicloud-acm, configuration with DataId {spring.application.name}. {file-extension} will be loaded first. If there is content in spring.profiles.active, the content of spring.profile, and configuration with the dataid format of{spring.application.name}-{profile}. {file-extension} will also be loaded in turn, and the latter has higher priority.</p>
</div>
<div class="paragraph">
<p>spring.profiles.active is the configuration metadata, and should also be configured in bootstrap.properties or bootstrap.yaml. For example, you can add the following content in bootstrap.properties.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>spring.profiles.active={profile-name}</pre>
</div>
</div>
<div class="paragraph">
<p>Note: You can also configure the granularity through JVM parameters such as -Dspring.profiles.active=develop or --spring.profiles.active=develop, which have higher priority. Just follow the specifications of Spring Boot.</p>
</div>
</div>
<div class="sect2">
<h3 id="_support_custom_acm_timeout">8.6. Support Custom ACM Timeout</h3>
<div class="paragraph">
<p>the default timeout of ACM client get config from sever is 3000 ms . If you need to define a timeout, set configuration <code>spring.cloud.alicloud.acm.timeout</code>,the unit is millisecond.</p>
</div>
</div>
<div class="sect2">
<h3 id="_support_custom_group_configurations">8.7. Support Custom Group Configurations</h3>
<div class="paragraph">
<p>DEFAULT_GROUP is used by default when no <code>{spring.cloud.alicloud.acm.group}</code> configuration is defined. If you need to define your own group, you can use the following method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="properties">spring.cloud.alicloud.acm.group=DEVELOP_GROUP</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This configuration must be placed in the bootstrap.properties file, and the value of Group must be the same with the value of <code>spring.cloud.alicloud.acm.group</code>.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_support_shared_configurations">8.7.1. Support Shared Configurations</h4>
<div class="paragraph">
<p>ACM provides a solution to share the same configuration across multiple applications. You can do this by adding the <code>spring.application.group</code> configuration in Bootstrap.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="properties">spring.application.group=company.department.team</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, you application will retrieve configurations from the following DataId in turn before it retrieves its own configuration: company:application.properties, company.department:application.properties, company.department.team:application.properties.
After that, it also retrieves configuration from  {spring.application.group}: {spring.application.name}. {file-extension}
The later in order, the higer the priority, and the unique configuration of the application itself has the highest priority.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The default suffix of DataId is properties, and you can change it using spring.cloud.alicloud.acm.file-extension. <code>{spring.application.group}: {spring.application.name}. {file-extension}</code> .
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If you configured <code>spring.profiles.active</code> , then the DataId format of <code>{spring.application.group}: {spring.application.name}-{spring.profiles.active}. {file-extension}</code> is also supported, and has higher priority than <code>{spring.application.group}: {spring.application.name}. {file-extension}</code>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_actuator_endpoint">8.8. Actuator Endpoint</h3>
<div class="paragraph">
<p>the Actuator endpoint of ACM is <code>/acm</code>, <code>config</code> represents the ACM metadata configuration information, <code>runtime.sources</code> corresponds to the configuration information obtained from the ACM server and the last refresh time, <code>runtime.refreshHistory</code> corresponds to the dynamic refresh history.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_spring_cloud_alibaba_cloud_oss">9. Spring Cloud Alibaba Cloud OSS</h2>
<div class="sectionbody">
<div class="paragraph">
<p>OSS（Object Storage Service）is a storage product on Alibaba Cloud. Spring Cloud Alibaba Cloud OSS provides the commercialized storage service in conformity with Spring Cloud specifications. We provide easy-to-use APIs and supports the integration of Resource in the Spring framework.</p>
</div>
<div class="sect2">
<h3 id="_how_to_introduce_spring_cloud_alibaba_cloud_oss">9.1. How to Introduce Spring Cloud Alibaba Cloud OSS</h3>
<div class="paragraph">
<p>We’ve released Spring Cloud Alibaba version 0.2.1. You will need to add dependency management POM first.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;dependencyManagement&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-alibaba-dependencies&lt;/artifactId&gt;
            &lt;version&gt;0.2.2.BUILD-SNAPSHOT&lt;/version&gt;
            &lt;type&gt;pom&lt;/type&gt;
            &lt;scope&gt;import&lt;/scope&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
&lt;/dependencyManagement&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next we need to introduce Spring Cloud Alibaba Cloud OSS Starter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-starter-alicloud-oss&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_how_to_use_oss_api">9.2. How to Use OSS API</h3>
<div class="sect3">
<h4 id="_configure_oss">9.2.1. Configure OSS</h4>
<div class="paragraph">
<p>Before you start to use Spring Cloud Alibaba Cloud OSS, please add the following configurations in application.properties.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="properties">spring.cloud.alicloud.access-key=Your Alibaba Cloud AK
spring.cloud.alicloud.secret-key=Your Alibaba Cloud SK
spring.cloud.alicloud.oss.endpoint=***.aliyuncs.com</code></pre>
</div>
</div>
<div class="paragraph">
<p>access-key and secret-key is the AK/SK of your Alibaba Cloud account. If you don’t have one, please register an account first, and log on to <a href="https://usercenter.console.aliyun.com/#/manage/ak">Alibaba Cloud AK/SK Management</a> to get your AccessKey ID and Access Key Secret . If you haven’t create the AccessKeys, click “Create AccessKey” to create one.</p>
</div>
<div class="paragraph">
<p>For endpoint information, please refer to the OSS <a href="https://help.aliyun.com/document_detail/31837.html">Documentation</a> and get the endpoint for your region.</p>
</div>
</div>
<div class="sect3">
<h4 id="_introduce_oss_api">9.2.2. Introduce OSS API</h4>
<div class="paragraph">
<p>The OSS API of Spring Cloud Alibaba Cloud OSS is based on the official OSS SDK, and includes APIs for uploading, downloading, viewing files.</p>
</div>
<div class="paragraph">
<p>Here is a simple application that uses the OSS API.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@SpringBootApplication
public class OssApplication {

    @Autowired
    private OSS ossClient;

    @RequestMapping("/")
    public String home() {
        ossClient.putObject("bucketName", "fileName", new FileInputStream("/your/local/file/path"));
        return "upload success";
    }

    public static void main(String[] args) throws URISyntaxException {
        SpringApplication.run(OssApplication.class, args);
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Before you upload your files, please  <a href="https://account.aliyun.com/register/register.htm?spm=5176.8142029.388261.26.e9396d3eaYK2sG&amp;oauth_callback=https%3A%2F%2Fwww.aliyun.com%2F">Register an Alibaba Cloud Account</a>. If you already have one, please  <a href="https://common-buy.aliyun.com/?spm=5176.8465980.unusable.dopen.4cdf1450rg8Ujb&amp;commodityCode=oss#/open">Sign up for OSS</a>.</p>
</div>
<div class="paragraph">
<p>Log on to the <a href="https://oss.console.aliyun.com/overview">OSS Console</a>, click “Create New Bucket” and create a bucket as instructed. Replace the bucket name in the “bucketname” of the previous code with your new bucket name.  "fileName” can be any name you like, and "/your/local/file/path” can be any local file path. Next you can run `curl <a href="http://127.0.0.1:port" class="bare">http://127.0.0.1:port</a> number/ to upload your files, and you will see your file on the <a href="https://oss.console.aliyun.com/overview">OSS Console</a>.</p>
</div>
<div class="paragraph">
<p>For more instructions on OSS APIs, please refer to <a href="https://help.aliyun.com/document_detail/32008.html">OSS SDK Documentation</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_integrate_with_the_resource_specifications_of_spring">9.3. Integrate with the Resource Specifications of Spring</h3>
<div class="paragraph">
<p>Spring Cloud Alibaba Cloud OSS integrates the Resource of the Spring framework, which allows you to use the OSS resources easily.</p>
</div>
<div class="paragraph">
<p>The following is a simple example of how to use Resource.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@SpringBootApplication
public class OssApplication {

    @Value("oss://bucketName/fileName")
    private Resource file;

    @GetMapping("/file")
    public String fileResource() {
        try {
            return "get file resource success. content: " + StreamUtils.copyToString(
                file.getInputStream(), Charset.forName(CharEncoding.UTF_8));
        } catch (Exception e) {
            return "get resource fail: " + e.getMessage();
        }
    }

    public static void main(String[] args) throws URISyntaxException {
        SpringApplication.run(OssApplication.class, args);
    }

}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
A prerequisite for the above sample is that you need to have a bucket named “bucketName” on OSS, and you have a file named “fileName” in this bucket.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_use_sts_authentication">9.4. Use STS Authentication</h3>
<div class="paragraph">
<p>In addition to AccessKeys, Spring Cloud Alibaba Cloud OSS also supports STS authentication. STS is an authentication method with temporary security tokens, and is usually used for a third party to access its resources temporarily.</p>
</div>
<div class="paragraph">
<p>For a third party to access resources temporarily, it only needs to complete the following configurations.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="properties">spring.cloud.alicloud.oss.authorization-mode=STS
spring.cloud.alicloud.oss.endpoint=***.aliyuncs.com
spring.cloud.alicloud.oss.sts.access-key=Your authenticated AK
spring.cloud.alicloud.oss.sts.secret-key=Your authenticated SK
spring.cloud.alicloud.oss.sts.security-token=Your authenticated ST</code></pre>
</div>
</div>
<div class="paragraph">
<p>Among which, spring.cloud.alicloud.oss.authorization-mode is the enumeration type. Fill in STS here means that STS authentication is used. For endpoint information, refer to the <a href="https://help.aliyun.com/document_detail/31837.html">OSS Documentation</a> and fill in the endpoint for your region.</p>
</div>
<div class="paragraph">
<p>Access-key, secret-key and the security-token need to be issued by the authentication side. For more information about STS, refer to <a href="https://help.aliyun.com/document_detail/31867.html">STS Documentation</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_more_configurations_for_the_client">9.5. More Configurations for the Client</h3>
<div class="paragraph">
<p>In addition to basic configurations, Spring Cloud Alibaba Cloud OSS also supports many other configurations, which are also included in the application.properties file.</p>
</div>
<div class="paragraph">
<p>Here are some examples.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="properties">spring.cloud.alicloud.oss.authorization-mode=STS
spring.cloud.alicloud.oss.endpoint=***.aliyuncs.com
spring.cloud.alicloud.oss.sts.access-key=Your authenticated AK
spring.cloud.alicloud.oss.sts.secret-key=Your authenticated SK
spring.cloud.alicloud.oss.sts.security-token=Your authenticated ST

spring.cloud.alicloud.oss.config.connection-timeout=3000
spring.cloud.alicloud.oss.config.max-connections=1000</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more configurations, refer to  the table at the bottom of <a href="https://help.aliyun.com/document_detail/32010.html">OSSClient Configurations</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
In most cases, you need to connect the parameter names with “-” for the parameters in the table of <a href="https://help.aliyun.com/document_detail/32010.html">OSSClient Configurations</a> with “-”, and all letters should be in lowercase. For example, ConnectionTimeout should be changed to connection-timeout.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_spring_cloud_alibaba_cloud_schedulerx">10. Spring Cloud Alibaba Cloud SchedulerX</h2>
<div class="sectionbody">
<div class="paragraph">
<p>SchedulerX（Distributed job scheduling） is a component of EDAS, an Alibaba Cloud product. Spring Cloud Alibaba Cloud SchedulerX provides distributed job scheduling in conformity with the Spring Cloud specifications. SchedulerX provides timed job scheduling service with high accuracy with seconds, high stability and high availabiliy, and supports multiple job types, such as simple single-server jobs, simple multi-host jobs, script jobs, and grid jobs.</p>
</div>
<div class="sect2">
<h3 id="_how_to_introduce_spring_cloud_alibaba_cloud_schedulerx">10.1. How to Introduce Spring Cloud Alibaba Cloud SchedulerX</h3>
<div class="paragraph">
<p>If you want to use SchedulerX in your project, please use the starter with the group ID as <code>com.alibaba.cloud</code> and the artifact ID as <code>spring-cloud-starter-alicloud-schedulerX</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-starter-alicloud-schedulerX&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_start_schedulerx">10.2. Start SchedulerX</h3>
<div class="paragraph">
<p>After Spring Cloud Alibaba Cloud SchedulerX Starter is introduced into the client, you only need to complete a few simple configurations and you will be able to initialize the SchedulerX service automatically.</p>
</div>
<div class="paragraph">
<p>The following is a simple example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@SpringBootApplication
public class ScxApplication {

    public static void main(String[] args) {
        SpringApplication.run(ScxApplication.class, args);
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Add the following configurations in the application.properties file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="properties">server.port=18033
# cn-test is the test region of SchedulerX
spring.cloud.alicloud.scx.group-id=***
spring.cloud.alicloud.edas.namespace=cn-test</code></pre>
</div>
</div>
<div class="paragraph">
<p>Before getting the group-id, please <a href="https://account.aliyun.com/register/register.htm?spm=5176.8142029.388261.26.e9396d3eEIv28g&amp;oauth_callback=https%3A%2F%2Fwww.aliyun.com%2F">Register an Alibaba Cloud account</a>, and then <a href="https://common-buy.aliyun.com/?spm=5176.11451019.0.0.6f5965c0Uq5tue&amp;commodityCode=edaspostpay#/buy">Sign up for EDAS</a> and <a href="https://edas.console.aliyun.com/#/edasTools">Sign up for SchedulerX</a> as well.</p>
</div>
<div class="paragraph">
<p>To get the group-id, refer to the <a href="https://help.aliyun.com/document_detail/98784.html">SchedulerX Documentation</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
When you create a group, please select the “test” region.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_compile_a_simple_job">10.3. Compile a simple job</h3>
<div class="paragraph">
<p>Simple job is the most commonly used job type. You only need to implement the ScxSimpleJobProcessor interface.</p>
</div>
<div class="paragraph">
<p>The following is a sample of a simple single-server job.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">public class SimpleTask implements ScxSimpleJobProcessor {

	@Override
	public ProcessResult process(ScxSimpleJobContext context) {
		System.out.println("-----------Hello world---------------");
		ProcessResult processResult = new ProcessResult(true);
		return processResult;
	}

}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_job_scheduling">10.4. Job Scheduling</h3>
<div class="paragraph">
<p>Go to the <a href="https://edas.console.aliyun.com/#/edasSchedulerXJob?regionNo=cn-test">SchedulerX Jobs</a> page, select the “Test” region, and click “Create Job” on the upper-right corner to create a job, as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="text">Job Group： Test——***-*-*-****
Job process interface：SimpleTask
Type： Simple Single-Server Job
Quartz Cron Expression： Default Option——0 * * * * ?
Job Description： Empty
Custom Parameters： Empty</code></pre>
</div>
</div>
<div class="paragraph">
<p>The job above is a “Simple Single-Server Job”, and specified a Cron expression of "0 * * * * ?" . This means that the job will be executed once and once only in every minute.</p>
</div>
<div class="paragraph">
<p>For more job types, refer to <a href="https://help.aliyun.com/document_detail/43136.html">SchedulerX Documentation</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_usage_in_production_environment">10.5. Usage in Production Environment</h3>
<div class="paragraph">
<p>The previous examples shows how to use SchedulerX in the “Test” region, which is mainly used for local testing.</p>
</div>
<div class="paragraph">
<p>At the production level, you need to complete some other configurations in addition to the group-id and namespace as mentioned above. See examples below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="properties">server.port=18033
# cn-test is the test region of SchedulerX
spring.cloud.alicloud.scx.group-id=***
spring.cloud.alicloud.edas.namespace=***
# If your application runs on EDAS, you do not need to configure the following.
spring.cloud.alicloud.access-key=***
spring.cloud.alicloud.secret-key=***
# The following configurations are not mandatory. You can refer to the SchedulerX documentation for details.
spring.cloud.alicloud.scx.domain-name=***</code></pre>
</div>
</div>
<div class="paragraph">
<p>The way to get the group-id is the same as described in the previous examples, and you can get the namespace by clicking “Namespaces” in the left-side navigation pane of the EDAS console.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Group-id must be created within a namespace.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Access-key and secret-key are the AK/SK of your Alibaba Cloud account. If you deploy you applications on EDAS, then you do not need to fill in this information. Otherwise please go to  <a href="https://usercenter.console.aliyun.com/#/manage/ak">Security Information</a> to get your AccessKeys.</p>
</div>
<div class="paragraph">
<p>Domain-name is not mandatory. You can refer to  <a href="https://help.aliyun.com/document_detail/35359.html">SchedulerX Documentation</a> for details.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_spring_cloud_alibaba_cloud_sms">11. Spring Cloud Alibaba Cloud SMS</h2>
<div class="sectionbody">
<div class="paragraph">
<p>SMS（Short Message Service）is a messaging service that covers the globe, Alibaba SMS provides convenient, efficient, and intelligent communication capabilities that help businesses quickly contact their customers.</p>
</div>
<div class="paragraph">
<p>Spring Cloud Alibaba Cloud SMS provide an easier-to-use API for quick access to Alibaba Cloud&#8217;s SMS service based on Spring Cloud Alibaba SMS.</p>
</div>
<div class="sect2">
<h3 id="_how_to_introduce_spring_cloud_alibaba_cloud_sms">11.1. How to Introduce Spring Cloud Alibaba Cloud SMS</h3>
<div class="paragraph">
<p>If you want to use SMS in your project, please use the starter with the group ID as <code>com.alibaba.cloud</code> and the artifact ID as <code>spring-cloud-starter-alicloud-sms</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-starter-alicloud-sms&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_how_to_use_sms_api">11.2. How to use SMS API</h3>
<div class="sect3">
<h4 id="_configure_sms">11.2.1. Configure SMS</h4>
<div class="paragraph">
<p>Before you start to use Spring Cloud Alibaba Cloud SMS, please add the following configurations in application.properties.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="properties">spring.cloud.alicloud.access-key=AK
spring.cloud.alicloud.secret-key=SK</code></pre>
</div>
</div>
<div class="paragraph">
<p>access-key and secret-key is the AK/SK of your Alibaba Cloud account. If you don’t have one, please register an account first, and log on to <a href="https://usercenter.console.aliyun.com/#/manage/ak">Alibaba Cloud AK/SK Management</a> to get your AccessKey ID and Access Key Secret . If you haven’t create the AccessKeys, click “Create AccessKey” to create one.</p>
</div>
</div>
<div class="sect3">
<h4 id="_introduce_sms_api">11.2.2. Introduce SMS API</h4>
<div class="paragraph">
<p>The SMS API in Spring Cloud Alicloud SMS is based on Alibaba Cloud SMS SDK. It has a single SMS sending, multiple SMS bulk sending, SMS query, SMS message (SMS receipt message and Upstream SMS message) class operation API.</p>
</div>
<div class="paragraph">
<p>The following is a simple example of how to use SMS api to send short message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@SpringBootApplication
public class SmsApplication {

    @Autowired
    private ISmsService smsService;

    @RequestMapping("/batch-sms-send.do")
    public SendBatchSmsResponse batchsendCheckCode(
            @RequestParam(name = "code") String code) {

        SendSmsRequest request = new SendSmsRequest();
        // Required:the mobile number
        request.setPhoneNumbers("152******");
        // Required:SMS-SignName-could be found in sms console
        request.setSignName("******");
        // Required:Template-could be found in sms console
        request.setTemplateCode("******");
        // Required:The param of sms template.For exmaple, if the template is "Hello,your verification code is ${code}". The param should be like following value
        request.setTemplateParam("{\"code\":\"" + code + "\"}");
        SendSmsResponse sendSmsResponse ;
        try {
            sendSmsResponse = smsService.sendSmsRequest(request);
        }
        catch (ClientException e) {
            e.printStackTrace();
            sendSmsResponse = new SendSmsResponse();
        }
        return sendSmsResponse ;
    }

    public static void main(String[] args) throws URISyntaxException {
        SpringApplication.run(SmsApplication.class, args);
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Before you send your messages, please <a href="https://account.aliyun.com/register/register.htm?spm=5176.8142029.388261.26.e9396d3eaYK2sG&amp;oauth_callback=https%3A%2F%2Fwww.aliyun.com%2F">Register an Alibaba Cloud Account</a>. If you already have one, please  <a href="https://dysms.console.aliyun.com/dysms.htm?spm=5176.8195934.1283918..18924183bHPct2&amp;accounttraceid=c8cb4243-3080-4eb1-96b0-1f2316584269#/">Turn on SMS Service</a>.</p>
</div>
<div class="paragraph">
<p>For more information about SMS , please refer to the SMS official <a href="https://help.aliyun.com/document_detail/55284.html?spm=a2c4g.11186623.6.568.715e4f30ZiVkbI">SMS</a> (SendSms)---JAVA] docs .</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Due to an issue with the earlier SMS sdk version, if the text message fails to be sent, please delete the line of code that contains the explicit MethodType as POST. If you still have problems, please contact us as soon as possible.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_the_advanced_features_of_sms_api">11.3. The Advanced Features of SMS Api</h3>
<div class="paragraph">
<p>In order to reduce the cost of learning, the API interface of the Spring Cloud Alicloud SMS package is kept as consistent as the API and Example provided by the official website.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Batch SMS sending</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Refer to the following example to quickly develop a feature with bulk SMS sending. Add the following code in the Controller or create a new Controller:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@RequestMapping("/batch-sms-send.do")
public SendBatchSmsResponse batchsendCheckCode(
        @RequestParam(name = "code") String code) {
    SendBatchSmsRequest request = new SendBatchSmsRequest();
    request.setMethod(MethodType.GET);
    request.setPhoneNumberJson("[\"177********\",\"130********\"]");
    request.setSignNameJson("[\"*******\",\"*******\"]");
    request.setTemplateCode("******");
    request.setTemplateParamJson(
            "[{\"code\":\"" + code + "\"},{\"code\":\"" + code + "\"}]");
    SendBatchSmsResponse sendSmsResponse ;
    try {
        sendSmsResponse = smsService
                .sendSmsBatchRequest(request);
        return sendSmsResponse;
    }
    catch (ClientException e) {
        e.printStackTrace();
        sendSmsResponse =  new SendBatchSmsResponse();
    }
    return sendSmsResponse ;
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The MethodType of the request is set to GET, which is somewhat different from the example given by the official website. This is because the inconsistent version of the dependent Alibaba Cloud POP API version causes incompatibility issues, set to GET.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>More parameter descriptions can be <a href="https://help.aliyun.com/document_detail/66041.html?spm=a2c4g.11186623.6.571.631315e8AauJhP">reference here</a></p>
</div>
<div class="ulist">
<ul>
<li>
<p>SMS Query</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Refer to the following example to quickly develop a history of sending SMS messages based on a specified number. Add the following code in the Controller or create a new Controller:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@RequestMapping("/query.do")
public QuerySendDetailsResponse querySendDetailsResponse(
        @RequestParam(name = "tel") String telephone) {
    QuerySendDetailsRequest request = new QuerySendDetailsRequest();
    request.setPhoneNumber(telephone);
    request.setSendDate("20190103");
    request.setPageSize(10L);
    request.setCurrentPage(1L);
    try {
        QuerySendDetailsResponse response = smsService.querySendDetails(request);
        return response;
    }
    catch (ClientException e) {
        e.printStackTrace();
    }

    return new QuerySendDetailsResponse();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>More parameter descriptions can be found at <a href="https://help.aliyun.com/document_detail/55289.html?spm=a2c4g.11186623.6.569.4f852c78mugEfx">reference here</a></p>
</div>
<div class="ulist">
<ul>
<li>
<p>SMS receipt message</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>By subscribing to the SmsReport SMS status report, you can know the status of each SMS message and whether it knows the status and related information of the terminal user. These efforts have been encapsulated internally by Spring Cloud AliCloud SMS. You only need to complete the following two steps.</p>
</div>
<div class="paragraph">
<p>1、Configure the queue name for SmsReport in the <code>application.properties</code> configuration file (which can also be application.yaml).</p>
</div>
<div class="listingblock">
<div class="title">application.properties</div>
<div class="content">
<pre>spring.cloud.alicloud.sms.report-queue-name=Alicom-Queue-********-SmsReport</pre>
</div>
</div>
<div class="paragraph">
<p>2、Implement the SmsReportMessageListener interface and initialize a Spring Bean.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@Component
public class SmsReportMessageListener
		implements SmsReportMessageListener {

	@Override
	public boolean dealMessage(Message message) {
	    //do something
		System.err.println(this.getClass().getName() + "; " + message.toString());
		return true;
	}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>More message body format for Message can be <a href="https://help.aliyun.com/document_detail/55496.html?spm=a2c4g.11186623.6.570.7f792c78rOiWXO">reference here</a>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Upstream SMS message</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>By subscribing to the SmsUp upstream SMS message, you can know the content of the end user replying to the SMS. These efforts have also been packaged by Spring Cloud AliCloud SMS. You only need to complete the following two steps.</p>
</div>
<div class="paragraph">
<p>1、Configure the queue name for SmsReport in the <code>application.properties</code> configuration file (which can also be application.yaml).</p>
</div>
<div class="listingblock">
<div class="title">application.properties</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="properties">spring.cloud.alicloud.sms.up-queue-name=Alicom-Queue-********-SmsUp</code></pre>
</div>
</div>
<div class="paragraph">
<p>2、Implement the SmsUpMessageListener interface and initialize a Spring Bean.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="java">@Component
public class SmsUpMessageListener
		implements org.springframework.cloud.alicloud.sms.SmsUpMessageListener {

	@Override
	public boolean dealMessage(Message message) {
    	//do something
		System.err.println(this.getClass().getName() + "; " + message.toString());
		return true;
	}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>More message body format for Message can be <a href="https://help.aliyun.com/document_detail/55496.html?spm=a2c4g.11186623.6.570.7f792c78rOiWXO">reference here</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_aot_and_native_image_support">12. AOT and Native Image Support</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduction_to_graalvm">12.1. Introduction to GraalVM</h3>
<div class="paragraph">
<p>One of the biggest changes of Spring Boot 3.0 is the support for GraalVM native images, which the official takes a lot of time and effort. GraalVM, as an alternative to JRE, precompels java applications through technologies such as Ahead Of Time (AOT), which enables Spring to grasp more information about applications when running applications and makes the whole application start faster. In addition, the final application is smaller and has a lower memory footprint by eliminating unnecessary content during the compilation process through the compilation tool. It is excellent for some scenarios that require very high startup speed, such as Serverless and FaaS scenarios. This Spring Boot 3.0 directly moves it from Spring Native to Spring Boot, which also indicates that this technology begins to mature gradually and Spring ecology begins to enter the GraalVM stage!</p>
</div>
<div class="paragraph">
<p><strong>GraalVM has the following features compared to the JVM compilation deployment:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>During the application construction phase, static analysis of the application begins at the main entry point.</p>
</li>
<li>
<p>When the native image is created, code analysis removes the inaccessible code and does not become part of the executable file, thus reducing the package size to some extent.</p>
</li>
<li>
<p>GraalVM cannot directly sense the dynamic elements of the code. Therefore, for applications with reflection, serialization, and dynamic proxies, hint configuration files need to be provided in advance to help resolve the application. Refer to the official documents for related operations.</p>
</li>
<li>
<p>The application classpath is fixed at build time and cannot be changed.</p>
</li>
<li>
<p>Without lazy class loading, everything in the executable will be loaded into memory at startup.</p>
</li>
<li>
<p>The supported Java applications have some limitations in some aspects. Therefore, it is not guaranteed that all the previous Java applications can directly use GraalVM technology for application construction, and there is a certain probability of incompatible exceptions.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Part of the middleware clients included in Spring Cloud Alibaba 2022.0.0.0 version of this release have completed the adaptation of constructing GraalVM native applications. The following is a sample application related to service registration, discovery  module supported by the community. After upgrading to Spring Boot 3.0, GraalVM is used to build a native application image to test the startup speed and runtime usage. (Sentinel, Seata and RocketMQ are still being adapted. The following test process is simulated for 5 times respectively under the environment of MacOS 11.4, 2.6GHz 6-Core Intel Core i7 processor and 16G memory) :</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./pic/graalvm_performance.png" alt="graalvm performance">
</div>
</div>
<div class="paragraph">
<p>From the above comparison, we can see that the latest Spring Cloud Alibaba application that supports Spring Boot 3.0 based on GraalVM will reduce application&#8217;s startup time, runtime memory usage and application package size. For example, Among them, the startup speed of the service registration consumption application is increased by nearly 10 times, and the running memory usage is reduced by nearly 2/3 compared with the original, which has a very obvious effect. This gives the cloud native era, hosting in the cloud application has brought significant advantages, so that it can be faster elastic expansion and contraction capacity and reduce the overall cost of the enterprise cloud!</p>
</div>
</div>
<div class="sect2">
<h3 id="_build_application_by_graalvm">12.2. Build Application by GraalVM</h3>
<div class="sect3">
<h4 id="_build_the_project">12.2.1. Build the project</h4>
<div class="paragraph">
<p>Among all the components supported by Spring Cloud Alibaba for Spring Boot 3.0 this time, Nacos 2.1.1-RC already supports GraalVM technology to build applications. Next, we&#8217;ll look at the components that use GraalVM to compile and run the application</p>
</div>
<div class="paragraph">
<p>The project construction can be carried out according to the general Spring Cloud Alibaba application construction method. The following are the relevant dependencies that must be added:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="xml">&lt;parent&gt;
  &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
  &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
  &lt;version&gt;3.0.0&lt;/version&gt;
  &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;
&lt;/parent&gt;
&lt;dependencies&gt;
&lt;dependency&gt;
  &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;
  &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
  &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
  &lt;artifactId&gt;spring-cloud-commons&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependencyManagement&gt;
  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
      &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt;
      &lt;version&gt;2022.0.0&lt;/version&gt;
      &lt;type&gt;pom&lt;/type&gt;
      &lt;scope&gt;import&lt;/scope&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;
      &lt;artifactId&gt;spring-cloud-alibaba-dependencies&lt;/artifactId&gt;
      &lt;version&gt;2022.0.0.0-RC1&lt;/version&gt;
      &lt;type&gt;pom&lt;/type&gt;
      &lt;scope&gt;import&lt;/scope&gt;
    &lt;/dependency&gt;
  &lt;/dependencies&gt;
&lt;/dependencyManagement&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above are necessary dependencies for registering Nacos through Spring Cloud Alibaba. Please adjust other dependencies according to your own needs. Please note that It is critical to use the GraalVM <code>spring-boot-starter-parent</code> parent module, which declares a native profile that contains the necessary information to create and run GraalVM native images. There are two ways to build a Spring Boot native image application:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use Spring Boot&#8217;s support for Cloud Native Buildpacks to generate lightweight containers containing native executables.</p>
</li>
<li>
<p>Use GraalVM Native Build Tools to generate a local executable file. As the first method has certain requirements on the local environment, If you need to use can refer to  <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/native-image.html#native-image.introducing-graalvm-native">Spring Boot 3.0</a> related user documents. The rest of this article demonstrates the second approach to GraalVM application building.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_preparation">12.2.2. Preparation</h4>
<div class="paragraph">
<p>To Build a Native image using Native Build Tools, you need to firstly install the GraalVM distribution on your machine. You can download it manually on the Liberica Native Image Kit page, or you can use tools like SDKMAN!. Run the following command to install the GraalVM environment:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="shell">sdk install java 22.3.r17-nik
sdk use java 22.3.r17-nik</code></pre>
</div>
</div>
<div class="paragraph">
<p>Verify that the correct version is configured by checking the output of java -version:：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="shell">$ java -version
openjdk version "17.0.5" 2022-10-18 LTS
OpenJDK Runtime Environment GraalVM 22.3.0 (build 17.0.5+8-LTS)
OpenJDK 64-Bit Server VM GraalVM 22.3.0 (build 17.0.5+8-LTS, mixed mode)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_generate_hint_file">12.2.3. Generate hint file</h4>
<div class="paragraph">
<p>Generate hint configuration files required for reflection, serialization, and dynamic proxies in your application by using the following command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="shell">mvn -Pnative spring-boot:run</code></pre>
</div>
</div>
<div class="paragraph">
<p>After our example application is launched, we need to test all functions of example as completely as possible to ensure that most code of the application is covered by test cases, so as to ensure that all necessary dynamic properties during the application operation are generated completely.
After running all the test cases, we found the following hint files are generated in <code>resource/META-INF/native image</code> directory:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>resource-config.json：Resource hint file</p>
</li>
<li>
<p>reflect-config.json：Reflection definition hint file</p>
</li>
<li>
<p>serialization-config.json：Serialization hint file</p>
</li>
<li>
<p>proxy-config.json：Proxy hint file</p>
</li>
<li>
<p>jni-config.json：JNI hint file</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_build_native_image">12.2.4. Build native image</h4>
<div class="paragraph">
<p>After all the above steps are in place, use the following command to build the native image:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="shell">mvn -Pnative native:compile</code></pre>
</div>
</div>
<div class="paragraph">
<p>After that, we can see the executable we generated in the <code>/target</code> directory.</p>
</div>
</div>
<div class="sect3">
<h4 id="_run_native_image">12.2.5. Run native image</h4>
<div class="paragraph">
<p>Like a normal executable file, launch this example with <code>target/nacos-config-2.4.x-example</code>,
You can observe output similar to the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="shell">2022-12-22T16:28:51.006+08:00  INFO 75439 --- [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8888 (http) with context path ''
2022-12-22T16:28:51.008+08:00  INFO 75439 --- [           main] c.a.cloud.imports.examples.Application   : Started Application in 0.653 seconds (process running for 0.662)</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can see that the application starts up much faster.
We can see the memory usage through ` vmmap pid | grep Physical ` command
The memory usage of applications started using native image is as follows</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>Physical footprint:         59.2M
Physical footprint (peak):  59.2M</code></pre>
</div>
</div>
<div class="paragraph">
<p>The memory usage of starting normal Java applications is as follows</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>Physical footprint:         214.0M
Physical footprint (peak):  256.8M</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, the memory usage is greatly reduced when the Java application is launched using the native image.
After the application is started, its abilities are the same as if it were started through a jar.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2022-12-29 19:23:34 +0800
</div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/run_prettify.min.js"></script>
</body>
</html>